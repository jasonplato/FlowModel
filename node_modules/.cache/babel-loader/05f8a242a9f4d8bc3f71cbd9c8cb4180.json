{"remainingRequest":"/Users/wangxufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js!/Users/wangxufei/Desktop/FlowModel/node_modules/eslint-loader/index.js??ref--13-0!/Users/wangxufei/Desktop/FlowModel/src/graph/scheduler.js","dependencies":[{"path":"/Users/wangxufei/Desktop/FlowModel/src/graph/scheduler.js","mtime":1652163070427},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy93YW5neHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvd2FuZ3h1ZmVpL0Rlc2t0b3AvRmxvd01vZGVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmV4cG9ydCB2YXIgU2NoZWR1bGVyID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBTY2hlZHVsZXIoZ3JhcGgsIGFudHZOb2RlcykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNjaGVkdWxlcik7CgogICAgdGhpcy5ncmFwaCA9IGdyYXBoOyAvLyBjb3VudGVyaSAmJiBjb3VudGVyaiDnlKjkuo7osIPluqblmajlnKjpgY3ljoYgbWV0YVBhdGgg5LqM57u05pWw57uE5pe25L2/55SoCgogICAgdGhpcy5jb3VudGVyaSA9IDA7CiAgICB0aGlzLmNvdW50ZXJqID0gMDsKICAgIHRoaXMubWV0YVBhdGggPSBbXTsKICAgIHRoaXMuYW50dk5vZGVzID0gYW50dk5vZGVzOwogICAgdGhpcy5zZXR1cE1ldGFQYXRoKCk7CiAgfSAvLyDku44gZ3JhcGgg5Lit6I635Y+W5pWw5o2u77yM5bu656uLIG1ldGEgcGF0aAoKCiAgX2NyZWF0ZUNsYXNzKFNjaGVkdWxlciwgW3sKICAgIGtleTogInNldHVwTWV0YVBhdGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldHVwTWV0YVBhdGgoKSB7CiAgICAgIHZhciB0bXBUaGlzID0gdGhpczsKICAgICAgdmFyIHRva2VuTm9kZXMgPSBuZXcgU2V0KCk7CiAgICAgIHRoaXMuYW50dk5vZGVzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAvLyBUT0RPIFtEb25lXSBGaWx0ZXIgb3V0IGxlYWYgbm9kZXMKICAgICAgICBpZiAodmFsdWUuZ2V0RGF0YSgpLnR5cGUgPT0gIlRva2VuIiAmJiAhdG1wVGhpcy5ncmFwaC5pc0xlYWZOb2RlKGtleSkpIHsKICAgICAgICAgIHRva2VuTm9kZXMuYWRkKGtleSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdG9rZW5Ob2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlSUQpIHsKICAgICAgICB0bXBUaGlzLmdldFJlbGF0ZWRNZXRhUGF0aCh0bXBUaGlzLmFudHZOb2Rlcy5nZXQobm9kZUlEKSwgW10sIG5ldyBTZXQoKSk7CiAgICAgIH0pOwogICAgICBjb25zb2xlLmxvZygidHJhdmVyc2FsIHJlc3VsdDoiKTsKICAgICAgY29uc29sZS5sb2codGhpcy5tZXRhUGF0aCk7CiAgICB9IC8vIOiOt+WPluS7peS4gOS4qiBUb2tlbiDoioLngrnkuLrotbflp4vngrnnmoTmiYDmnInlhYPot6/lvoQKCiAgfSwgewogICAga2V5OiAiZ2V0UmVsYXRlZE1ldGFQYXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZWxhdGVkTWV0YVBhdGgobm9kZSwgY3VyLCB2aXNpdGVkKSB7CiAgICAgIGlmIChub2RlLmdldERhdGEoKS50eXBlICE9ICJUb2tlbiIgJiYgdmlzaXRlZC5oYXMobm9kZS5pZCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChub2RlLmdldERhdGEoKS50eXBlID09ICJUb2tlbiIgJiYgY3VyLmxlbmd0aCA+IDApIHsKICAgICAgICBjdXIucHVzaChub2RlLmlkKTsKICAgICAgICB2YXIgdG1wUmVzID0gW107CiAgICAgICAgY3VyLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgIHRtcFJlcy5wdXNoKGVsZW1lbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMubWV0YVBhdGgucHVzaCh0bXBSZXMpOwogICAgICAgIGN1ci5wb3AoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmdyYXBoLmlzTGVhZk5vZGUobm9kZSkpIHsKICAgICAgICAvLyBUT0RPIHByaW50IG91dCB3YXJuaW5nIG1lc3NnYWUKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBlZGdlcyA9IHRoaXMuZ3JhcGgubW9kZWwuZ2V0T3V0Z29pbmdFZGdlcyhub2RlKTsKICAgICAgY3VyLnB1c2gobm9kZS5pZCk7CiAgICAgIHZpc2l0ZWQuYWRkKG5vZGUuaWQpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlZGdlcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBuZXh0Tm9kZSA9IGVkZ2VzW2ldLmdldFRhcmdldE5vZGUoKTsKICAgICAgICB0aGlzLmdldFJlbGF0ZWRNZXRhUGF0aChuZXh0Tm9kZSwgY3VyLCB2aXNpdGVkKTsKICAgICAgfQoKICAgICAgY3VyLnBvcCgpOwogICAgfSAvLyDkvp3nhacgbWV0YVBhdGgg55qE5ouT5omR57uT5p6E6L+b6KGM6LCD5bqmCiAgICAvLyBQYXJhbWV0ZXI6ICAgZGF5CiAgICAvLyBSZXR1cm46ICAgICAgW3ByZU5vZGUsIGN1ck5vZGUsIGVuZEZsYWddIAogICAgLy8gICAgICAgICAgICAgIGVuZEZsYWcgPT0gdHJ1ZSDooajnpLrmiYDmnIkgbWV0YSBwYXRoIOmDveW3sue7j+mBjeWOhui/h+S6hgoKICB9LCB7CiAgICBrZXk6ICJzY2hlZHVsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2NoZWR1bGUoKSB7CiAgICAgIGlmICh0aGlzLmNvdW50ZXJpID49IHRoaXMubWV0YVBhdGgubGVuZ3RoKSB7CiAgICAgICAgdmFyIHJlcyA9IHsKICAgICAgICAgIHByZU5vZGU6IG51bGwsCiAgICAgICAgICBjdXJOb2RlOiBudWxsLAogICAgICAgICAgZW5kRmxhZzogdHJ1ZQogICAgICAgIH07CiAgICAgICAgdGhpcy5jb3VudGVyaSA9IDA7CiAgICAgICAgdGhpcy5jb3VudGVyaiA9IDA7CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQoKICAgICAgdmFyIHJlcyA9IHsKICAgICAgICBwcmVOb2RlOiB0aGlzLmNvdW50ZXJqIC0gMSA+PSAwID8gdGhpcy5tZXRhUGF0aFt0aGlzLmNvdW50ZXJpXVt0aGlzLmNvdW50ZXJqIC0gMV0gOiBudWxsLAogICAgICAgIGN1ck5vZGU6IHRoaXMubWV0YVBhdGhbdGhpcy5jb3VudGVyaV1bdGhpcy5jb3VudGVyal0sCiAgICAgICAgZW5kRmxhZzogZmFsc2UKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmNvdW50ZXJqICsgMSA+PSB0aGlzLm1ldGFQYXRoW3RoaXMuY291bnRlcmldLmxlbmd0aCkgewogICAgICAgIHRoaXMuY291bnRlcmkrKzsKICAgICAgICB0aGlzLmNvdW50ZXJqID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvdW50ZXJqKys7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2NoZWR1bGVyOwp9KCk7"},{"version":3,"sources":["/Users/wangxufei/Desktop/FlowModel/src/graph/scheduler.js"],"names":["Scheduler","graph","antvNodes","counteri","counterj","metaPath","setupMetaPath","tmpThis","tokenNodes","Set","forEach","value","key","getData","type","isLeafNode","add","nodeID","getRelatedMetaPath","get","console","log","node","cur","visited","has","id","length","push","tmpRes","element","pop","edges","model","getOutgoingEdges","i","nextNode","getTargetNode","res","preNode","curNode","endFlag"],"mappings":"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","sourcesContent":["export class Scheduler {\n\n    constructor(graph, antvNodes) {\n        this.graph = graph;\n      \n        // counteri && counterj 用于调度器在遍历 metaPath 二维数组时使用\n        this.counteri = 0;\n        this.counterj = 0;\n        this.metaPath = [];\n        this.antvNodes = antvNodes;\n\n        this.setupMetaPath();\n    }\n\n    // 从 graph 中获取数据，建立 meta path\n    setupMetaPath() {\n        var tmpThis = this;\n        let tokenNodes = new Set();\n\n        this.antvNodes.forEach(function(value, key){\n            // TODO [Done] Filter out leaf nodes\n            if (value.getData().type == \"Token\" && !tmpThis.graph.isLeafNode(key)) {\n                tokenNodes.add(key);\n            }\n        });\n\n        tokenNodes.forEach(nodeID => {\n            tmpThis.getRelatedMetaPath(tmpThis.antvNodes.get(nodeID), [], new Set());\n        });\n\n        console.log(\"traversal result:\");\n        console.log(this.metaPath);\n        \n    } \n\n\n    // 获取以一个 Token 节点为起始点的所有元路径\n    getRelatedMetaPath(node, cur, visited) {\n        if (node.getData().type != \"Token\" && visited.has(node.id)) {\n          return ;\n        }\n  \n        if (node.getData().type == \"Token\" && cur.length > 0) {\n          cur.push(node.id);\n        \n          let tmpRes = [];\n          cur.forEach(element => {\n            tmpRes.push(element);\n          });\n          this.metaPath.push(tmpRes);\n\n          cur.pop();\n          return ;\n        }\n  \n        if (this.graph.isLeafNode(node)) {\n          // TODO print out warning messgae\n          return ;\n        }\n      \n        let edges = this.graph.model.getOutgoingEdges(node);\n        \n        cur.push(node.id);\n        visited.add(node.id);\n        \n        for (let i = 0; i < edges.length; i++) {\n          let nextNode = edges[i].getTargetNode();\n          this.getRelatedMetaPath(nextNode, cur, visited);\n        }\n  \n        cur.pop();\n    }\n\n    // 依照 metaPath 的拓扑结构进行调度\n    // Parameter:   day\n    // Return:      [preNode, curNode, endFlag] \n    //              endFlag == true 表示所有 meta path 都已经遍历过了\n    schedule() {\n        if (this.counteri >= this.metaPath.length ) {\n          var res = {\n            preNode: null,\n            curNode: null,\n            endFlag: true\n          };\n\n          this.counteri = 0;\n          this.counterj = 0;\n\n          return res;\n        }\n\n        var res = {\n            preNode: this.counterj - 1 >= 0 ? this.metaPath[this.counteri][this.counterj - 1] : null,\n            curNode: this.metaPath[this.counteri][this.counterj],\n            endFlag: false\n        };\n\n        if (this.counterj + 1 >= this.metaPath[this.counteri].length) {\n          this.counteri++;\n          this.counterj = 0;\n        } else {\n          this.counterj++;\n        }\n\n        return res;\n    }\n}"]}]}