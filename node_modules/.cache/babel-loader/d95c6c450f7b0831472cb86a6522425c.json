{"remainingRequest":"/Users/xufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js!/Users/xufei/Desktop/FlowModel/node_modules/eslint-loader/index.js??ref--13-0!/Users/xufei/Desktop/FlowModel/src/graph/model.js","dependencies":[{"path":"/Users/xufei/Desktop/FlowModel/src/graph/model.js","mtime":1653708835730},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/cache-loader/dist/cjs.js","mtime":1653708689072},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js","mtime":1653708688758},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/eslint-loader/index.js","mtime":1653708690128}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMveHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiL1VzZXJzL3h1ZmVpL0Rlc2t0b3AvRmxvd01vZGVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMveHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMveHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IHsgU2NoZWR1bGVyIH0gZnJvbSAiLi9zY2hlZHVsZXIiOwppbXBvcnQgeyBBY3Rpb24sIFN0YWtlLCBVbnN0YWtlLCBWZXN0IH0gZnJvbSAiLi9hY3Rpb24iOwppbXBvcnQgeyBUb2tlbiB9IGZyb20gIi4vdG9rZW4iOwppbXBvcnQgeyBTbGVlcCB9IGZyb20gIi4vLi4vdXRpbHMvc2xlZXAiOwppbXBvcnQgeyBTdGFuZGFyZE51bSB9IGZyb20gIi4uL3V0aWxzL251bWJlclV0aWwiOyAvLyB2YXIgaXNQYXVzZWQgPSBmYWxzZTsKLy8gc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGUpIHsKLy8gICAgIC8vIGNvbnNvbGUubG9nKCJ0aHJlYWQgbWVzc2FnZToiLCBlKTsKLy8gICAgIHZhciBkYXRhID0gZS5kYXRhOwovLyAgICAgc3dpdGNoIChkYXRhKSB7Ci8vICAgICAgIGNhc2UgJ3BhdXNlJzoKLy8gICAgICAgICBjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tLS0td29ya2VyIHBhdXNlZCIpOwovLyAgICAgICAgIGlzUGF1c2VkID0gdHJ1ZTsKLy8gICAgICAgICBicmVhazsKLy8gICAgICAgZGVmYXVsdDoKLy8gICAgICAgICAvLyBzZWxmLnBvc3RNZXNzYWdlKCdVbmtub3duIGNvbW1hbmQ6ICcgKyBkYXRhLm1zZyk7Ci8vICAgICB9OwovLyAgIH0sIGZhbHNlKTsKCmV4cG9ydCB2YXIgTW9kZWwgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIE1vZGVsKGdyYXBoLCBlbmREYXksIHNsb3QpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNb2RlbCk7CgogICAgdGhpcy5ncmFwaCA9IGdyYXBoOyAvLyBlbmREYXk6IOaooeWei+eahOa1i+eul+e7iOatouaXtumXtAoKICAgIHRoaXMuZW5kRGF5ID0gTnVtYmVyKGVuZERheSk7IC8vIHNsb3Q6IOaooeWei+a1i+eul+eahOWBnOmhv+eql+WPo++8jOavj+malOi/meS4gOauteaXtumXtOaooeWei+a1i+eul+i/h+eoi+S8muWBnOmhvyA1c++8jOaWueS+v+aTjeS9nOiAhei/m+ihjOS4i+S4gOatpeeahOiwg+aVtAoKICAgIHRoaXMuc2xvdCA9IE51bWJlcihzbG90KTsgLy8gc3RhdHVzOiDmqKHlnovlpITkuo7lk6rkuKrnirbmgIHkuK0gMCAtIG9mZiwgMSAtIG9uLCAyIC0gcGF1c2UKCiAgICB0aGlzLnN0YXR1cyA9IE51bWJlcigxKTsgLy8gY3VyRGF5OiDmqKHlnovmtYvnrpfnmoTlvZPliY3ml7bpl7QKCiAgICB0aGlzLmN1ckRheSA9IE51bWJlcigxKTsgLy8gYW50dk5vZGVzIOS/neWtmOeahOaYr+WOn+WniyBhbnR2IOWumuS5ieeahOiKgueCueWvueixoQogICAgLy8gVE9ETyBhbnR2Tm9kZXMg5piv5ZCm5LuF5LuF5Zyo5Yid5aeL5YyW55qE5pe25YCZ55So5Yiw77yfCgogICAgdGhpcy5hbnR2Tm9kZXMgPSBuZXcgTWFwKCk7IC8vIG5vZGVzSW5zdGFuY2Ug5L+d5a2Y5omA5pyJ6IqC54K55a+56LGh5pWw5o2uIDxrZXk6IHRva2VuSUQsIHZhbHVlOiBub2RlQ2xhc3NJbnN0YW5jZT4KCiAgICB0aGlzLm5vZGVzSW5zdGFuY2UgPSBuZXcgTWFwKCk7IC8vIGFjdGlvbiDlhoXljIXlkKsgc3Rha2VMYWJlbElETWFwLCB1bnN0YWtlTGFiZWxJRE1hcCwgdmVzdExhYmVsSURNYXAKCiAgICB0aGlzLmFjdGlvbiA9IG5ldyBBY3Rpb24oKTsgLy8gdG9rZW5MYWJlbElETWFwIDxrZXk6IG5vZGVMYWJlbCwgdmFsdWU6IG5vZGVJRD4KCiAgICB0aGlzLnRva2VuTGFiZWxJRE1hcCA9IG5ldyBNYXAoKTsgLy8gRWRnZU1hcCA8a2V5OiBzb3VyY2VJRCwgdmFsdWU6IDxrZXk6IHRhcmdldElELCB2YWx1ZTogRWRnZUNsYXNzSW5zdGFuY2U+ID4KCiAgICB0aGlzLmVkZ2VNYXAgPSBuZXcgTWFwKCk7IC8vIGRhdGE6IOa1i+eul+aooeWei+a1i+eul+i/h+eoi+S4reS6p+eUn+eahOaVsOaNrgoKICAgIHRoaXMuZGF0YSA9IFtdOwogICAgdGhpcy5pbml0RGF0YSgpOwogICAgdGhpcy5zY2hlZHVsZXIgPSBuZXcgU2NoZWR1bGVyKGdyYXBoLCB0aGlzLmFudHZOb2Rlcyk7IC8vIHRoaXMuZGF0YTogWwogICAgLy8gICAgIHsKICAgIC8vICAgICAgICAgdHlwZTogIlRva2VuMiIsCiAgICAvLyAgICAgICAgIGRhdGE6IFsKICAgIC8vICAgICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgICAgICB0eXBlOiAiVGVhbSIsCiAgICAvLyAgICAgICAgICAgICAgICAgZGF0YTogWwogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDAsIHZhbHVlOiA2MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDEsIHZhbHVlOiA4MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDIsIHZhbHVlOiA5MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDMsIHZhbHVlOiA4MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDQsIHZhbHVlOiA5MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDUsIHZhbHVlOiAxMTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA2LCB2YWx1ZTogMTIwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNywgdmFsdWU6IDE0MCB9LAogICAgLy8gICAgICAgICAgICAgICAgIF0KICAgIC8vICAgICAgICAgICAgIH0sCiAgICAvLyAgICAgICAgICAgICB7CiAgICAvLyAgICAgICAgICAgICAgICAgdHlwZTogIkNvbW11bml0eSIsCiAgICAvLyAgICAgICAgICAgICAgICAgZGF0YTogWwogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDAsIHZhbHVlOiA1MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDEsIHZhbHVlOiA5MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDIsIHZhbHVlOiA0MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDMsIHZhbHVlOiA4MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDQsIHZhbHVlOiAzMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDUsIHZhbHVlOiAxMTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA2LCB2YWx1ZTogMTcwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNywgdmFsdWU6IDE4MCB9LAogICAgLy8gICAgICAgICAgICAgICAgIF0KICAgIC8vICAgICAgICAgICAgIH0KICAgIC8vICAgICAgICAgXQogICAgLy8gICAgIH0sCiAgICAvLyAgICAgewogICAgLy8gICAgICAgICB0eXBlOiAiVG9rZW4xIiwKICAgIC8vICAgICAgICAgZGF0YTogWwogICAgLy8gICAgICAgICAgICAgewogICAgLy8gICAgICAgICAgICAgICAgIHR5cGU6ICJUZWFtIiwKICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBbCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMCwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMSwgdmFsdWU6IDEwMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDIsIHZhbHVlOiA5MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDMsIHZhbHVlOiAxMDAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA0LCB2YWx1ZTogOTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA1LCB2YWx1ZTogMTEwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNiwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNywgdmFsdWU6IDEyMCB9LAogICAgLy8gICAgICAgICAgICAgICAgIF0KICAgIC8vICAgICAgICAgICAgIH0sCiAgICAvLyAgICAgICAgICAgICB7CiAgICAvLyAgICAgICAgICAgICAgICAgdHlwZTogIkNvbW11bml0eSIsCiAgICAvLyAgICAgICAgICAgICAgICAgZGF0YTogWwogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDAsIHZhbHVlOiA3MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDEsIHZhbHVlOiAxMTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAyLCB2YWx1ZTogODAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAzLCB2YWx1ZTogMTkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNCwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNSwgdmFsdWU6IDEwMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDYsIHZhbHVlOiA3MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDcsIHZhbHVlOiAxNTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICBdCiAgICAvLyAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgIF0KICAgIC8vICAgICB9CiAgICAvLyBdCiAgfQoKICBfY3JlYXRlQ2xhc3MoTW9kZWwsIFt7CiAgICBrZXk6ICJpbml0RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdERhdGEoKSB7CiAgICAgIHRoaXMuZ2V0Tm9kZXMoKTsKICAgICAgdGhpcy5nZXRFZGdlcygpOwogICAgfSAvLyDojrflj5blvZPliY3nlLvluIPkuIrnmoTmiYDmnInoioLngrnvvIzkv53lrZjoioLngrnljp/lp4sgYW50diDmlbDmja7lkoznlKjmiLfphY3nva7lsZ7mgKflj4LmlbAKCiAgfSwgewogICAga2V5OiAiZ2V0Tm9kZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5vZGVzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy8g6I635Y+W5omA5pyJ6IqC54K555qEIGFudHYg55u45YWz5pWw5o2u77yM5ZCM5pe25bu656uL6LW35LiN5ZCM6IqC54K557G75Z6L55qEIGxhYmVsKOeUqOaIt+iuvue9rueahOiKgueCueWQjeWtlykgLT4gaWQg55qE5pig5bCE6KGoCiAgICAgIHZhciBub2RlcyA9IHRoaXMuZ3JhcGgubW9kZWwuZ2V0Tm9kZXMoKTsKICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIF90aGlzLmFudHZOb2Rlcy5zZXQoZWxlbWVudC5pZCwgZWxlbWVudCk7CgogICAgICAgIHN3aXRjaCAoZWxlbWVudC5nZXREYXRhKCkudHlwZSkgewogICAgICAgICAgY2FzZSAiVG9rZW4iOgogICAgICAgICAgICBfdGhpcy50b2tlbkxhYmVsSURNYXAuc2V0KGVsZW1lbnQubGFiZWwsIGVsZW1lbnQuaWQpOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAiU3Rha2UiOgogICAgICAgICAgICBfdGhpcy5hY3Rpb24uc3Rha2VMYWJlbElETWFwLnNldChlbGVtZW50LmxhYmVsLCBlbGVtZW50LmlkKTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgIlVuc3Rha2UiOgogICAgICAgICAgICBfdGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXAuc2V0KGVsZW1lbnQubGFiZWwsIGVsZW1lbnQuaWQpOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAiVmVzdCI6CiAgICAgICAgICAgIF90aGlzLmFjdGlvbi52ZXN0TGFiZWxJRE1hcC5zZXQoZWxlbWVudC5sYWJlbCwgZWxlbWVudC5pZCk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBjb25zb2xlLmxvZygibm9kZXM6IiwgdGhpcy5hbnR2Tm9kZXMpOyAvLyDliJ3lp4vljJYgVG9rZW4g6IqC54K55a+56LGh5bm25Yqg5YWl5YiwIG5vZGVzSW5zdGFuY2Ug5LitCgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy50b2tlbkxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXA7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgaXRlbSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgdmFyIGFudHZOb2RlID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KGl0ZW1bMV0pOwogICAgICAgICAgdmFyIG5vZGVEYXRhID0gYW50dk5vZGUuZ2V0RGF0YSgpLm5vZGVEYXRhLnRva2VuRGF0YTsKICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5zZXQoaXRlbVsxXSwgbmV3IFRva2VuKGl0ZW1bMF0sIG5vZGVEYXRhLnRvdGFsU3VwcGx5LCBub2RlRGF0YS5hbGxvY2F0aW9ucywgbm9kZURhdGEuY29tbXVuaXR5KSk7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCh7CiAgICAgICAgICAgIHR5cGU6IGl0ZW1bMF0sCiAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIOagueaNriBzdGFrZSDoioLngrnnmoQgcmV3YXJkUG9saWN5RnJvbSDlj4LmlbDvvIzmm7TmlrDlr7nlupTnmoQgdG9rZW4g6IqC54K555qEIHN0YWtpbmdQb29sIOWPguaVsAogICAgICAgIC8vIFRPRE8g6Z2e5bi45LiR6ZmL77yM5aaC5L2V5LyY5YyW77yfCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24uc3Rha2VMYWJlbElETWFwKSwKICAgICAgICAgIF9zdGVwMjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfaXRlbSA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICB2YXIgX2FudHZOb2RlID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtWzFdKTsKCiAgICAgICAgICB2YXIgX25vZGVEYXRhID0gX2FudHZOb2RlLmdldERhdGEoKS5ub2RlRGF0YS5zdGFrZURhdGE7CgogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmdldCh0aGlzLnRva2VuTGFiZWxJRE1hcC5nZXQoX25vZGVEYXRhLnJld2FyZFBvbGljeUZyb20pKS5jb21tdW5pdHlQb2xpY3kuc3Rha2luZ1Bvb2wrKzsKICAgICAgICB9IC8vIOWIneWni+WMliBzdGFrZSDoioLngrnlr7nosaHlubbliqDlhaXliLAgbm9kZXNJbnN0YW5jZSDkuK0KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuYWN0aW9uLnN0YWtlTGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDM7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX2l0ZW0yID0gX3N0ZXAzLnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGUyID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtMlsxXSk7CgogICAgICAgICAgdmFyIF9ub2RlRGF0YTIgPSBfYW50dk5vZGUyLmdldERhdGEoKS5ub2RlRGF0YS5zdGFrZURhdGE7CgogICAgICAgICAgdmFyIHRva2VuSW5zdGFuY2UgPSB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHRoaXMudG9rZW5MYWJlbElETWFwLmdldChfbm9kZURhdGEyLnJld2FyZFBvbGljeUZyb20pKTsKICAgICAgICAgIHZhciByZXdhcmRQb2xpY3kgPSB7CiAgICAgICAgICAgIC8vIOatpOWkhCByZXdhcmRUb3RhbCDmjIfnmoTmmK/ljZXkuKogc3Rha2Ug5rGg5a2Q5omA6IO96YeK5pS+5aWW5Yqx55qE5oC76YeP44CC5YW25YC85Y+W5Yaz5LqO6YeK5pS+55qEIHRva2VuIOS4reiuvue9rueahCBDb21tdW5pdHkgU3Rha2luZyDmgLvph4/pmaTku6Xlj6/ku6Xph4rmlL7or6UgdG9rZW4g55qEIHN0YWtlIOaxoOaAu+aVsCAgCiAgICAgICAgICAgIHJld2FyZFRvdGFsOiBTdGFuZGFyZE51bSh0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5hbGxvY2F0aW9ucy5nZXQoIlN0YWtpbmciKSAqIHRva2VuSW5zdGFuY2UuYWxsb2NhdGlvblBlcmNlbnQuZ2V0KCJDb21tdW5pdHkiKSAqIHRva2VuSW5zdGFuY2UudG90YWxTdXBwbHkgLyB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUG9vbCksCiAgICAgICAgICAgIHJld2FyZExpZmV0aW1lOiB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUmV3YXJkTGlmZXRpbWUsCiAgICAgICAgICAgIHJld2FyZFJlZnJlc2hQZXJpb2Q6IHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdSZXdhcmRSZWZyZXNoUGVyaW9kLAogICAgICAgICAgICByZXdhcmREZWZhY3RvcjogdG9rZW5JbnN0YW5jZS5jb21tdW5pdHlQb2xpY3kuc3Rha2luZ1Jld2FyZERlZmFjdG9yCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLnNldChfaXRlbTJbMV0sIG5ldyBTdGFrZShfaXRlbTJbMF0sIHJld2FyZFBvbGljeSwgX25vZGVEYXRhMi5zdGFrZUFtb3VudCkpOwogICAgICAgICAgdGhpcy5kYXRhLnB1c2goewogICAgICAgICAgICB0eXBlOiBfaXRlbTJbMF0sCiAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIOWIneWni+WMliB1bnN0YWtlIOiKgueCueWvueixoeW5tuWKoOWFpeWIsCBub2Rlc0luc3RhbmNlIOS4rQoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXA0OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtMyA9IF9zdGVwNC52YWx1ZTsKCiAgICAgICAgICB2YXIgX2FudHZOb2RlMyA9IHRoaXMuYW50dk5vZGVzLmdldChfaXRlbTNbMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGEzID0gX2FudHZOb2RlMy5nZXREYXRhKCkubm9kZURhdGEudW5zdGFrZURhdGE7CgogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLnNldChfaXRlbTNbMV0sIG5ldyBVbnN0YWtlKF9pdGVtM1swXSwgX25vZGVEYXRhMy5jb29sRG93blRpbWUsIF9ub2RlRGF0YTMudW5zdGFrZUFtb3VudCkpOwogICAgICAgICAgdGhpcy5kYXRhLnB1c2goewogICAgICAgICAgICB0eXBlOiBfaXRlbTNbMF0sCiAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIOWIneWni+WMliB2ZXN0IOiKgueCueWvueixoeW5tuWKoOWFpeWIsCBub2Rlc0luc3RhbmNlIOS4rQoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yNC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yNC5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24udmVzdExhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXA1OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtNCA9IF9zdGVwNS52YWx1ZTsKCiAgICAgICAgICB2YXIgX2FudHZOb2RlNCA9IHRoaXMuYW50dk5vZGVzLmdldChfaXRlbTRbMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGE0ID0gX2FudHZOb2RlNC5nZXREYXRhKCkubm9kZURhdGEudmVzdERhdGE7CgogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLnNldChfaXRlbTRbMV0sIG5ldyBWZXN0KF9pdGVtNFswXSwgX25vZGVEYXRhNC52ZXN0QW1vdW50KSk7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCh7CiAgICAgICAgICAgIHR5cGU6IF9pdGVtNFswXSwKICAgICAgICAgICAgZGF0YTogW10KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yNS5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yNS5mKCk7CiAgICAgIH0KICAgIH0gLy8g6I635Y+W5b2T5YmN55S75biD5LiK55qE5omA5pyJ6L6577yM5L+d5a2Y6L655LiK55So5oi36YWN572u55qE5bGe5oCn5Y+C5pWwCgogIH0sIHsKICAgIGtleTogImdldEVkZ2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFZGdlcygpIHsvLyBsZXQgZWRnZXMgPSB0aGlzLmdyYXBoLmdldEVkZ2VzKCkKICAgICAgLy8gZWRnZXMuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgLy8gICAgIGxldCBzcmMgPSBlbGVtZW50LmdldFNvdXJjZU5vZGUoKS5pZDsKICAgICAgLy8gICAgIGxldCBkc3QgPSBlbGVtZW50LmdldFRhcmdldE5vZGUoKS5pZDsKICAgICAgLy8gICAgIGxldCBlZGdlRGF0YSA9IGVsZW1lbnQuZ2V0RGF0YSgpLmVkZ2VEYXRhOwogICAgICAvLyAgICAgY29uc29sZS5sb2coImVkZ2VzIiwgZWRnZURhdGEpOwogICAgICAvLyAgICAgbGV0IGVkZ2UgPSBuZXcgRWRnZShzcmMsIGRzdCwgZWRnZURhdGEuZGlzdHJpYnV0aW9uKTsKICAgICAgLy8gICAgIGlmICh0aGlzLmVkZ2VNYXAuZ2V0KHNyYykgPT0gdW5kZWZpbmVkKSB7CiAgICAgIC8vICAgICAgICAgdGhpcy5lZGdlTWFwLnNldChzcmMsIG5ldyBNYXAoKSk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICB0aGlzLmVkZ2VNYXAuZ2V0KHNyYykuc2V0KGRzdCwgZWRnZSk7CiAgICAgIC8vIH0pCiAgICB9CiAgfSwgewogICAga2V5OiAic3RhcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zdGFydCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgc3RlcDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmN1ckRheSA8PSB0aGlzLmVuZERheSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGVwID0gdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoKTsKCiAgICAgICAgICAgICAgICBpZiAoIShzdGVwLmVuZEZsYWcgPT0gdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDmm7TmlrDmiYDmnInoioLngrkKICAgICAgICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgfSk7IC8vIOS4uuaVsOaNruWPr+inhuWMluWBmuWHhuWkh++8jOabtOaWsOa1i+eul+i/h+eoi+S4reavj+aXpeeahOWKqOaAgeaVsOaNriAKCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURhaWx5RGF0YSgpOyAvLyDmr4/pmpTkuIDmrrXlkajmnJ/pg73mmoLlgZwgNXMKCiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLnNsb3QgPiAwICYmIHRoaXMuY3VyRGF5ICUgdGhpcy5zbG90ID09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBTbGVlcCg1MDAwKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgdGhpcy5jdXJEYXkrKzsgLy8g5aaC5p6c5qih5Z6L5aSE5LqOIE9mZiAvIFBhdXNlIOeKtuaAge+8jOebtOaOpei3s+WHuuWHveaVsAoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuc3RhdHVzID09IDAgfHwgdGhpcy5zdGF0dXMgPT0gMikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImNvbnRpbnVlIiwgMCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHN0ZXAuY3VyTm9kZSkgPT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGxvZyDmiqXplJnmj5DnpLo6IOS4jeWtmOWcqOivpeiKgueCuQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVycm9yOjogY3VyIG5vZGUgZG9lcyBub3QgZXhpc3QhIiwgc3RlcCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJicmVhayIsIDE5KTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkYXk6IiwgdGhpcy5jdXJEYXkpOyAvLyDmiafooYzlvZPliY3oioLngrnnmoQgcnVuIOaWueazlQoKICAgICAgICAgICAgICAgIGlmIChzdGVwLnByZU5vZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHN0ZXAuY3VyTm9kZSkucnVuKG51bGwsIHRoaXMuY3VyRGF5KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5nZXQoc3RlcC5jdXJOb2RlKS5ydW4odGhpcy5ub2Rlc0luc3RhbmNlLmdldChzdGVwLnByZU5vZGUpLCB0aGlzLmN1ckRheSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIC8vIOS4uuaVsOaNruWPr+inhuWMluWBmuWHhuWkh++8jOabtOaWsOS4gOasoea1i+eul+aAu+S9k+eahOaVsOaNru+8jOWmgiB1bnN0YWtlSGlzdG9yeSwgdmVzdEhpc3Rvcnkg562JCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU92ZXJhbGxEYXRhKCk7IC8vIGxvZyDmj5DnpLo6IOa1i+eul+i/kOihjOWujOavlQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHN0YXJ0KCkgewogICAgICAgIHJldHVybiBfc3RhcnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHN0YXJ0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAidXBkYXRlRGFpbHlEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVEYWlseURhdGEoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8g5pu05pawIHRva2VuIOiKgueCueebuOWFs+eahCBkYXRhCiAgICAgICAgaWYgKHRoaXMudG9rZW5MYWJlbElETWFwLmhhcyh0aGlzLmRhdGFbaV0udHlwZSkpIHsKICAgICAgICAgIHZhciB0bXBJbnN0YW5jZSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy50b2tlbkxhYmVsSURNYXAuZ2V0KHRoaXMuZGF0YVtpXS50eXBlKSk7IC8vIHRoaXMuZGF0YSDnmoTmlbDmja7nu5PmnoTlpoLkuIvmiYDnpLoKICAgICAgICAgIC8vIHRoaXMuZGF0YToKICAgICAgICAgIC8vIFsKICAgICAgICAgIC8vICAgICB7CiAgICAgICAgICAvLyAgICAgICAgIHR5cGU6ICJUb2tlbjIiLAogICAgICAgICAgLy8gICAgICAgICBkYXRhOiBbCiAgICAgICAgICAvLyAgICAgICAgICAgICB7CiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgdHlwZTogIlRlYW0iLAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGRhdGE6IFsKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAwLCB2YWx1ZTogNjAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAxLCB2YWx1ZTogODAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAyLCB2YWx1ZTogOTAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAzLCB2YWx1ZTogODAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA0LCB2YWx1ZTogOTAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA1LCB2YWx1ZTogMTEwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNiwgdmFsdWU6IDEyMCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDcsIHZhbHVlOiAxNDAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAvLyAgICAgICAgICAgICB9LCAvLyDlj4LkuI7ogIUgZGF0YSDln58KICAgICAgICAgIC8vICAgICAgICAgICAgIHsKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0eXBlOiAiQ29tbXVuaXR5IiwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBbCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMCwgdmFsdWU6IDUwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMSwgdmFsdWU6IDkwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMiwgdmFsdWU6IDQwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMywgdmFsdWU6IDgwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNCwgdmFsdWU6IDMwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNSwgdmFsdWU6IDExMCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDYsIHZhbHVlOiAxNzAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA3LCB2YWx1ZTogMTgwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgXQogICAgICAgICAgLy8gICAgICAgICAgICAgfSAvLyDlj4LkuI7ogIUgZGF0YSDln58KICAgICAgICAgIC8vICAgICAgICAgXQogICAgICAgICAgLy8gICAgIH0sIC8vIOiKgueCuSBkYXRhIOWfnwogICAgICAgICAgLy8gXQogICAgICAgICAgLy8g5a+55LqO5q+P5Liq6IqC54K577yM5YW26IqC54K555qEIGRhdGEg5Z+f5YaF5Lya5pyJ5LiN5ZCM55qE6KeS6ImyLCDlpoIgVGVhbSwgQ29tbXVuaXR5IOetiTsg5L2G5piv6IqC54K5IGRhdGEg5Z+f5piv5LiA5Liq5pWw57uE77yM55Sx5LqO5bCG6IqC54K55ZCr5pyJ55qE6KeS6Imy5pWw5o2u5o+S5YWlIGRhdGEg5Z+f5pWw57uE55qE6L+H56iL5LiN5piv5pyJ5bqP55qE5omA5Lul5LiN6IO955u05o6l5qC55o2u5LiL5qCH5bCx5a6a5L2N5Yiw5p+Q5Liq6KeS6Imy77yMCiAgICAgICAgICAvLyDmiYDku6XmraTlpITpnIDopoHkv53lrZjkuIDkuKrmmKDlsIQgcm9sZUlkeE1hcCwga2V5IOS4uuinkuiJsiwgdmFsdWUg5Li66K+l6KeS6Imy5Zyo6IqC54K5IGRhdGEg5Z+f5pWw57uE5YaF55qE5LiL5qCH77yM5pa55L6/5ZCO57ut5pON5L2c5oyH5a6a6IqC54K555qE5oyH5a6a6KeS6ImyIGRhdGEg5Z+fCgogICAgICAgICAgdmFyIHJvbGVJZHhNYXAgPSBuZXcgTWFwKCk7IC8vIOagueaNruiKgueCuSBkYXRhIOWfn+S4reW3suWMheWQq+eahOinkuiJsuadpeWIneWni+WMliByb2xlSWR4TWFwCgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmRhdGFbaV0uZGF0YS5sZW5ndGg7IGorKykgewogICAgICAgICAgICByb2xlSWR4TWFwLnNldCh0aGlzLmRhdGFbaV0uZGF0YVtqXS50eXBlLCBqKTsKICAgICAgICAgIH0gLy8gVE9ETyDnm67liY3lr7nkuo4gdG9rZW4g6IqC54K55Y+q5pSv5oyB5bCGIGZyZWVNb25leSDmlbDmja7lj6/op4bljJYKCgogICAgICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0bXBJbnN0YW5jZS5mcmVlTW9uZXkpLAogICAgICAgICAgICAgIF9zdGVwNjsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXA2LnZhbHVlOwoKICAgICAgICAgICAgICAvLyDlpoLmnpwgcm9sZUlkeE1hcCDkuK3ov5jmsqHmnInljIXlkKvmn5DkuKrop5LoibLvvIjkuZ/mhI/lkbPnnYDoioLngrkgZGF0YSDln5/kuK3ov5jmnKrljIXlkKvmn5DkuKrop5LoibLvvInvvIzliJnlnKjoioLngrkgZGF0YSDln5/kuK3kuLror6Xop5LoibLmj5LlhaXorrDlvZXvvIzlkIzml7blsIYgcm9sZSAtPiBpZHgg55qE5pig5bCE5YWz57O75L+d5a2Y6LW35p2lCiAgICAgICAgICAgICAgaWYgKCFyb2xlSWR4TWFwLmhhcyhpdGVtWzBdKSkgewogICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMuZGF0YVtpXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICB0eXBlOiBpdGVtWzBdLAogICAgICAgICAgICAgICAgICBkYXRhOiBbXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByb2xlSWR4TWFwLnNldChpdGVtWzBdLCBsZW4gLSAxKTsKICAgICAgICAgICAgICB9IC8vIOW+gOiKgueCuSBkYXRhIOWfn+S4i+eahOinkuiJsiBkYXRhIOWfn+aPkuWFpeaVsOaNrgoKCiAgICAgICAgICAgICAgdGhpcy5kYXRhW2ldLmRhdGFbcm9sZUlkeE1hcC5nZXQoaXRlbVswXSldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICB0aW1lOiBTdHJpbmcodGhpcy5jdXJEYXkpLAogICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW1bMV0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yNi5mKCk7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyDmm7TmlrAgc3Rha2Ug6IqC54K555u45YWz55qEIGRhdGHvvIzku6PnoIHpgLvovpHlkozlrp7njrDkuI7kuIrpnaLlr7kgdG9rZW4g6IqC54K555qE5aSE55CG55u45ZCMCiAgICAgICAgZWxzZSBpZiAodGhpcy5hY3Rpb24uc3Rha2VMYWJlbElETWFwLmhhcyh0aGlzLmRhdGFbaV0udHlwZSkpIHsKICAgICAgICAgICAgdmFyIF90bXBJbnN0YW5jZSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy5hY3Rpb24uc3Rha2VMYWJlbElETWFwLmdldCh0aGlzLmRhdGFbaV0udHlwZSkpOwoKICAgICAgICAgICAgdmFyIF9yb2xlSWR4TWFwID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgZm9yICh2YXIgX2ogPSAwOyBfaiA8IHRoaXMuZGF0YVtpXS5kYXRhLmxlbmd0aDsgX2orKykgewogICAgICAgICAgICAgIF9yb2xlSWR4TWFwLnNldCh0aGlzLmRhdGFbaV0uZGF0YVtfal0udHlwZSwgX2opOwogICAgICAgICAgICB9IC8vIFRPRE8g55uu5YmN5a+55LqOIHN0YWtlIOiKgueCueWPquaUr+aMgeWwhiByZXdhcmRBbGxvY2F0ZWQg5pWw5o2u5Y+v6KeG5YyWCgoKICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihfdG1wSW5zdGFuY2UucmV3YXJkQWxsb2NhdGVkKSwKICAgICAgICAgICAgICAgIF9zdGVwNzsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I3LnMoKTsgIShfc3RlcDcgPSBfaXRlcmF0b3I3Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgIHZhciBfaXRlbTUgPSBfc3RlcDcudmFsdWU7CgogICAgICAgICAgICAgICAgaWYgKCFfcm9sZUlkeE1hcC5oYXMoX2l0ZW01WzBdKSkgewogICAgICAgICAgICAgICAgICB2YXIgX2xlbiA9IHRoaXMuZGF0YVtpXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGU6IF9pdGVtNVswXSwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXQogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIF9yb2xlSWR4TWFwLnNldChfaXRlbTVbMF0sIF9sZW4gLSAxKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmRhdGFbaV0uZGF0YVtfcm9sZUlkeE1hcC5nZXQoX2l0ZW01WzBdKV0uZGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgICAgdGltZTogU3RyaW5nKHRoaXMuY3VyRGF5KSwKICAgICAgICAgICAgICAgICAgdmFsdWU6IF9pdGVtNVsxXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I3LmUoZXJyKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBfaXRlcmF0b3I3LmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICB9IC8vIOS4uuaVsOaNruWPr+inhuWMluWKn+iDveacjeWKoe+8jOabtOaWsOWNleasoea1i+eul+eahOaAu+S9k+aVsOaNru+8jOWmgiB1bnN0YWtlSGlzdG9yeSwgdmVzdEhpc3Rvcnkg562JCgogIH0sIHsKICAgIGtleTogInVwZGF0ZU92ZXJhbGxEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVPdmVyYWxsRGF0YSgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyDmm7TmlrAgdW5zdGFrZSDoioLngrnnm7jlhbPnmoQgZGF0Ye+8jOS7o+eggemAu+i+keWSjOWunueOsOS4juS4iumdouWvuSB0b2tlbiDoioLngrnnmoTlpITnkIblpKfkvZPnm7jkvLzvvIznqI3mnInkuI3lkIwKICAgICAgICBpZiAodGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXAuaGFzKHRoaXMuZGF0YVtpXS50eXBlKSkgewogICAgICAgICAgdmFyIG9yaWdpbmFsSGlzdG9yeSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXAuZ2V0KHRoaXMuZGF0YVtpXS50eXBlKSkudW5zdGFrZUhpc3Rvcnk7CiAgICAgICAgICB2YXIgb3JkZXJlZEhpc3RvcnkgPSBuZXcgTWFwKCk7IC8vIOeUseS6jiB1bnN0YWtlSGlzdG9yeSDnmoTmj5LlhaXpobrluo/lj6/og73kuI3mmK/mjInlpKnnmoTpobrluo/mj5LlhaXvvIzmiYDku6XpnIDopoHph43mlrDmjInlpKnmjpLluo8KCiAgICAgICAgICB2YXIga2V5cyA9IG5ldyBBcnJheSgpOwoKICAgICAgICAgIHZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3JpZ2luYWxIaXN0b3J5KSwKICAgICAgICAgICAgICBfc3RlcDg7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9zdGVwOC52YWx1ZTsKICAgICAgICAgICAgICBrZXlzLnB1c2goTnVtYmVyKGl0ZW1bMF0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjguZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yOC5mKCk7CiAgICAgICAgICB9CgogICAgICAgICAga2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIoYSkgLSBOdW1iZXIoYik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwga2V5cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgb3JkZXJlZEhpc3Rvcnkuc2V0KE51bWJlcihrZXlzW19pXSksIG9yaWdpbmFsSGlzdG9yeS5nZXQoa2V5c1tfaV0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcm9sZUlkeE1hcCA9IG5ldyBNYXAoKTsKCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuZGF0YVtpXS5kYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIHJvbGVJZHhNYXAuc2V0KHRoaXMuZGF0YVtpXS5kYXRhW2pdLnR5cGUsIGopOyAvLyByb2xlVGltZWRhdGFJZHhNYXAuc2V0KHRoaXMuZGF0YVtpXS5kYXRhW2pdLnR5cGUsIG5ldyBNYXAoKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9pdGVyYXRvcjkgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvcmRlcmVkSGlzdG9yeSksCiAgICAgICAgICAgICAgX3N0ZXA5OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yOS5zKCk7ICEoX3N0ZXA5ID0gX2l0ZXJhdG9yOS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIF9pdGVtNiA9IF9zdGVwOS52YWx1ZTsKCiAgICAgICAgICAgICAgLy8gaXRlbToge2tleTog5pe26Ze0LCB2YWx1ZToge2tleToiVGVhbSIsIHZhbHVlOiAxMDB9fQogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKF9pdGVtNlsxXSksCiAgICAgICAgICAgICAgICAgIF9zdGVwMTA7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjEwLnMoKTsgIShfc3RlcDEwID0gX2l0ZXJhdG9yMTAubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgICB2YXIgaXRlbTIgPSBfc3RlcDEwLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgLy8gaXRlbTI6IHtrZXk6ICJUZWFtIiwgdmFsdWU6IDEwMH0KICAgICAgICAgICAgICAgICAgaWYgKCFyb2xlSWR4TWFwLmhhcyhpdGVtMlswXSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbGVuID0gdGhpcy5kYXRhW2ldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpdGVtMlswXSwKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcm9sZUlkeE1hcC5zZXQoaXRlbTJbMF0sIGxlbiAtIDEpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB0aGlzLmRhdGFbaV0uZGF0YVtyb2xlSWR4TWFwLmdldChpdGVtMlswXSldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGltZTogU3RyaW5nKF9pdGVtNlswXSksCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0yWzFdCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMTAuZShlcnIpOwogICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IxMC5mKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yOS5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3I5LmYoKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIOabtOaWsCB2ZXN0IOiKgueCueebuOWFs+eahCBkYXRhLCDku6PnoIHpgLvovpHlkozlrp7njrDkuI7kuIrpnaLlr7kgdG9rZW4g6IqC54K555qE5aSE55CG5aSn5L2T55u45Ly877yM56iN5pyJ5LiN5ZCMCiAgICAgICAgZWxzZSBpZiAodGhpcy5hY3Rpb24udmVzdExhYmVsSURNYXAuaGFzKHRoaXMuZGF0YVtpXS50eXBlKSkgewogICAgICAgICAgICB2YXIgX29yaWdpbmFsSGlzdG9yeSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy5hY3Rpb24udmVzdExhYmVsSURNYXAuZ2V0KHRoaXMuZGF0YVtpXS50eXBlKSkudmVzdEhpc3Rvcnk7CgogICAgICAgICAgICB2YXIgX29yZGVyZWRIaXN0b3J5ID0gbmV3IE1hcCgpOyAvLyDnlLHkuo4gdmVzdEhpc3Rvcnkg55qE5o+S5YWl6aG65bqP5LiN5piv5oyJ5aSp55qE6aG65bqP5o+S5YWl77yM5omA5Lul6ZyA6KaB6YeN5paw5oyJ5aSp5o6S5bqPCgoKICAgICAgICAgICAgdmFyIF9rZXlzID0gbmV3IEFycmF5KCk7CgogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yMTEgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihfb3JpZ2luYWxIaXN0b3J5KSwKICAgICAgICAgICAgICAgIF9zdGVwMTE7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMTEucygpOyAhKF9zdGVwMTEgPSBfaXRlcmF0b3IxMS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX2l0ZW03ID0gX3N0ZXAxMS52YWx1ZTsKCiAgICAgICAgICAgICAgICBfa2V5cy5wdXNoKF9pdGVtN1swXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3IxMS5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMTEuZigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfa2V5cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IF9rZXlzLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgICAgICBfb3JkZXJlZEhpc3Rvcnkuc2V0KF9rZXlzW19pMl0sIF9vcmlnaW5hbEhpc3RvcnkuZ2V0KF9rZXlzW19pMl0pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9yb2xlSWR4TWFwMiA9IG5ldyBNYXAoKTsKCiAgICAgICAgICAgIGZvciAodmFyIF9qMiA9IDA7IF9qMiA8IHRoaXMuZGF0YVtpXS5kYXRhLmxlbmd0aDsgX2oyKyspIHsKICAgICAgICAgICAgICBfcm9sZUlkeE1hcDIuc2V0KHRoaXMuZGF0YVtpXS5kYXRhW19qMl0udHlwZSwgX2oyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjEyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoX29yZGVyZWRIaXN0b3J5KSwKICAgICAgICAgICAgICAgIF9zdGVwMTI7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMTIucygpOyAhKF9zdGVwMTIgPSBfaXRlcmF0b3IxMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX2l0ZW04ID0gX3N0ZXAxMi52YWx1ZTsKCiAgICAgICAgICAgICAgICAvLyBpdGVtOiB7a2V5OiDml7bpl7QsIHZhbHVlOiB7a2V5OiJUZWFtIiwgdmFsdWU6IDEwMH19CiAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yMTMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihfaXRlbThbMV0pLAogICAgICAgICAgICAgICAgICAgIF9zdGVwMTM7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IxMy5zKCk7ICEoX3N0ZXAxMyA9IF9pdGVyYXRvcjEzLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX2l0ZW05ID0gX3N0ZXAxMy52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaXRlbTI6IHtrZXk6ICJUZWFtIiwgdmFsdWU6IDEwMH0KICAgICAgICAgICAgICAgICAgICBpZiAoIV9yb2xlSWR4TWFwMi5oYXMoX2l0ZW05WzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9sZW4yID0gdGhpcy5kYXRhW2ldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IF9pdGVtOVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW10KICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIF9yb2xlSWR4TWFwMi5zZXQoX2l0ZW05WzBdLCBfbGVuMiAtIDEpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhW2ldLmRhdGFbX3JvbGVJZHhNYXAyLmdldChfaXRlbTlbMF0pXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdGltZTogU3RyaW5nKF9pdGVtOFswXSksCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogX2l0ZW05WzFdCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IxMy5lKGVycik7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IxMy5mKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3IxMi5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMTIuZigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8g5b2T5qih5Z6L5LuO5pqC5YGc54q25oCB6YeN5paw5ZCv5Yqo5rWL566X5pe277yM55So5oi35Y+v6IO95a+55Y+C5pWw6L+b6KGM5LqG5L+u5pS577yM5paw55qE5Y+C5pWw6ZyA6KaB5pu05paw5Yiw5qih5Z6L5LitCgogIH0sIHsKICAgIGtleTogInNlbGZVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGZVcGRhdGUoZ3JhcGgsIGVuZERheSwgc2xvdCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIC8vIOehruS/nSBlbmREYXkg5aSn5LqO5b2T5YmNCiAgICAgIGlmIChlbmREYXkgPCB0aGlzLmN1ckRheSkgewogICAgICAgIGNvbnNvbGUubG9nKCJlbmQgZGF5IGlzIGlsbGVnYWwhIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmVuZERheSA9IGVuZERheTsKICAgICAgdGhpcy5zbG90ID0gc2xvdDsKICAgICAgdmFyIG5vZGVzID0gZ3JhcGgubW9kZWwuZ2V0Tm9kZXMoKTsKICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIF90aGlzMi5hbnR2Tm9kZXMuc2V0KGVsZW1lbnQuaWQsIGVsZW1lbnQpOwogICAgICB9KTsgLy8g5pu05pawIFRva2VuIOiKgueCueWvueixoQoKICAgICAgdmFyIF9pdGVyYXRvcjE0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy50b2tlbkxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXAxNDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxNC5zKCk7ICEoX3N0ZXAxNCA9IF9pdGVyYXRvcjE0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAxNC52YWx1ZTsKICAgICAgICAgIHZhciBhbnR2Tm9kZSA9IHRoaXMuYW50dk5vZGVzLmdldChpdGVtWzFdKTsKICAgICAgICAgIHZhciBub2RlRGF0YSA9IGFudHZOb2RlLmdldERhdGEoKS5ub2RlRGF0YS50b2tlbkRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlIHRva2VuIGRhdGE6Iiwgbm9kZURhdGEpOwogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmdldChpdGVtWzFdKS5zZWxmVXBkYXRlKGl0ZW1bMF0sIG5vZGVEYXRhLnRvdGFsU3VwcGx5LCBub2RlRGF0YS5hbGxvY2F0aW9ucywgbm9kZURhdGEuY29tbXVuaXR5KTsKICAgICAgICB9IC8vIOabtOaWsCBzdGFrZSDoioLngrnlr7nosaEKCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxNC5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3IxNSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMuYWN0aW9uLnN0YWtlTGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDE1OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjE1LnMoKTsgIShfc3RlcDE1ID0gX2l0ZXJhdG9yMTUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtMTAgPSBfc3RlcDE1LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGU1ID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtMTBbMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGE1ID0gX2FudHZOb2RlNS5nZXREYXRhKCkubm9kZURhdGEuc3Rha2VEYXRhOwoKICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGUgc3Rha2UgZGF0YToiLCBfbm9kZURhdGE1KTsKICAgICAgICAgIHZhciB0b2tlbkluc3RhbmNlID0gdGhpcy5ub2Rlc0luc3RhbmNlLmdldCh0aGlzLnRva2VuTGFiZWxJRE1hcC5nZXQoX25vZGVEYXRhNS5yZXdhcmRQb2xpY3lGcm9tKSk7CiAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlIHN0YWtlIGRhdGEgcmV3YXJkUG9saWN5RnJvbToiLCBfbm9kZURhdGE1LnJld2FyZFBvbGljeUZyb20pOwogICAgICAgICAgdmFyIHJld2FyZFBvbGljeSA9IHsKICAgICAgICAgICAgLy8g5q2k5aSEIHJld2FyZFRvdGFsIOaMh+eahOaYr+WNleS4qiBzdGFrZSDmsaDlrZDmiYDog73ph4rmlL7lpZblirHnmoTmgLvph4/jgILlhbblgLzlj5blhrPkuo7ph4rmlL7nmoQgdG9rZW4g5Lit6K6+572u55qEIENvbW11bml0eSBTdGFraW5nIOaAu+mHj+mZpOS7peWPr+S7pemHiuaUvuivpSB0b2tlbiDnmoQgc3Rha2Ug5rGg5oC75pWwICAKICAgICAgICAgICAgcmV3YXJkVG90YWw6IFN0YW5kYXJkTnVtKHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LmFsbG9jYXRpb25zLmdldCgiU3Rha2luZyIpICogdG9rZW5JbnN0YW5jZS5hbGxvY2F0aW9uUGVyY2VudC5nZXQoIkNvbW11bml0eSIpICogdG9rZW5JbnN0YW5jZS50b3RhbFN1cHBseSAvIHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdQb29sKSwKICAgICAgICAgICAgcmV3YXJkTGlmZXRpbWU6IHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdSZXdhcmRMaWZldGltZSwKICAgICAgICAgICAgcmV3YXJkUmVmcmVzaFBlcmlvZDogdG9rZW5JbnN0YW5jZS5jb21tdW5pdHlQb2xpY3kuc3Rha2luZ1Jld2FyZFJlZnJlc2hQZXJpb2QsCiAgICAgICAgICAgIHJld2FyZERlZmFjdG9yOiB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUmV3YXJkRGVmYWN0b3IKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KF9pdGVtMTBbMV0pLnNlbGZVcGRhdGUoX2l0ZW0xMFswXSwgcmV3YXJkUG9saWN5LCBfbm9kZURhdGE1LnN0YWtlQW1vdW50KTsKICAgICAgICB9IC8vIOabtOaWsCB1bnN0YWtlIOiKgueCueWvueixoQoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMTUuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjE1LmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjE2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXAxNjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxNi5zKCk7ICEoX3N0ZXAxNiA9IF9pdGVyYXRvcjE2Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfaXRlbTExID0gX3N0ZXAxNi52YWx1ZTsKCiAgICAgICAgICB2YXIgX2FudHZOb2RlNiA9IHRoaXMuYW50dk5vZGVzLmdldChfaXRlbTExWzFdKTsKCiAgICAgICAgICB2YXIgX25vZGVEYXRhNiA9IF9hbnR2Tm9kZTYuZ2V0RGF0YSgpLm5vZGVEYXRhLnVuc3Rha2VEYXRhOwoKICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGUgdW5zdGFrZSBkYXRhOiIsIF9ub2RlRGF0YTYpOwogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmdldChfaXRlbTExWzFdKS5zZWxmVXBkYXRlKF9pdGVtMTFbMF0sIF9ub2RlRGF0YTYuY29vbERvd25UaW1lLCBfbm9kZURhdGE2LnVuc3Rha2VBbW91bnQpOwogICAgICAgIH0gLy8g5pu05pawIHZlc3Qg6IqC54K55a+56LGhCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxNi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTYuZigpOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yMTcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi52ZXN0TGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDE3OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjE3LnMoKTsgIShfc3RlcDE3ID0gX2l0ZXJhdG9yMTcubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtMTIgPSBfc3RlcDE3LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGU3ID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtMTJbMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGE3ID0gX2FudHZOb2RlNy5nZXREYXRhKCkubm9kZURhdGEudmVzdERhdGE7CgogICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSB2ZXN0IGRhdGE6IiwgX25vZGVEYXRhNyk7CiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KF9pdGVtMTJbMV0pLnNlbGZVcGRhdGUoX2l0ZW0xMlswXSwgX25vZGVEYXRhNy52ZXN0QW1vdW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE3LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxNy5mKCk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBNb2RlbDsKfSgpOw=="},{"version":3,"sources":["/Users/xufei/Desktop/FlowModel/src/graph/model.js"],"names":["Scheduler","Action","Stake","Unstake","Vest","Token","Sleep","StandardNum","Model","graph","endDay","slot","Number","status","curDay","antvNodes","Map","nodesInstance","action","tokenLabelIDMap","edgeMap","data","initData","scheduler","getNodes","getEdges","nodes","model","forEach","element","set","id","getData","type","label","stakeLabelIDMap","unstakeLabelIDMap","vestLabelIDMap","console","log","item","antvNode","get","nodeData","tokenData","totalSupply","allocations","community","push","stakeData","rewardPolicyFrom","communityPolicy","stakingPool","tokenInstance","rewardPolicy","rewardTotal","allocationPercent","rewardLifetime","stakingRewardLifetime","rewardRefreshPeriod","stakingRewardRefreshPeriod","rewardDefactor","stakingRewardDefactor","stakeAmount","unstakeData","coolDownTime","unstakeAmount","vestData","vestAmount","step","schedule","endFlag","value","key","update","updateDailyData","curNode","undefined","preNode","run","updateOverallData","i","length","has","tmpInstance","roleIdxMap","j","freeMoney","len","time","String","rewardAllocated","originalHistory","unstakeHistory","orderedHistory","keys","Array","sort","a","b","item2","vestHistory","selfUpdate"],"mappings":"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","sourcesContent":["import { Scheduler } from \"./scheduler\";\nimport { Action, Stake, Unstake, Vest } from \"./action\";\nimport { Token } from \"./token\";\nimport { Sleep } from \"./../utils/sleep\";\nimport { StandardNum } from \"../utils/numberUtil\";\n\n// var isPaused = false;\n// self.addEventListener('message', function (e) {\n//     // console.log(\"thread message:\", e);\n//     var data = e.data;\n//     switch (data) {\n//       case 'pause':\n//         console.log(\"---------------worker paused\");\n//         isPaused = true;\n//         break;\n//       default:\n//         // self.postMessage('Unknown command: ' + data.msg);\n//     };\n//   }, false);\n\nexport class Model {\n\n    constructor(graph, endDay, slot) {\n        this.graph = graph;\n        // endDay: 模型的测算终止时间\n        this.endDay = Number(endDay);\n        // slot: 模型测算的停顿窗口，每隔这一段时间模型测算过程会停顿 5s，方便操作者进行下一步的调整\n        this.slot = Number(slot);\n        // status: 模型处于哪个状态中 0 - off, 1 - on, 2 - pause\n        this.status = Number(1);\n        // curDay: 模型测算的当前时间\n        this.curDay = Number(1);\n        // antvNodes 保存的是原始 antv 定义的节点对象\n        // TODO antvNodes 是否仅仅在初始化的时候用到？\n        this.antvNodes = new Map();\n        // nodesInstance 保存所有节点对象数据 <key: tokenID, value: nodeClassInstance>\n        this.nodesInstance = new Map();\n        // action 内包含 stakeLabelIDMap, unstakeLabelIDMap, vestLabelIDMap\n        this.action = new Action();\n        // tokenLabelIDMap <key: nodeLabel, value: nodeID>\n        this.tokenLabelIDMap = new Map();\n        // EdgeMap <key: sourceID, value: <key: targetID, value: EdgeClassInstance> >\n        this.edgeMap = new Map();\n        // data: 测算模型测算过程中产生的数据\n        this.data = [];\n\n        this.initData();\n\n        this.scheduler = new Scheduler(graph, this.antvNodes);\n        \n        // this.data: [\n        //     {\n        //         type: \"Token2\",\n        //         data: [\n        //             {\n        //                 type: \"Team\",\n        //                 data: [\n        //                     { time: 0, value: 60 },\n        //                     { time: 1, value: 80 },\n        //                     { time: 2, value: 90 },\n        //                     { time: 3, value: 80 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 120 },\n        //                     { time: 7, value: 140 },\n        //                 ]\n        //             },\n        //             {\n        //                 type: \"Community\",\n        //                 data: [\n        //                     { time: 0, value: 50 },\n        //                     { time: 1, value: 90 },\n        //                     { time: 2, value: 40 },\n        //                     { time: 3, value: 80 },\n        //                     { time: 4, value: 30 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 170 },\n        //                     { time: 7, value: 180 },\n        //                 ]\n        //             }\n\n        //         ]\n        //     },\n        //     {\n        //         type: \"Token1\",\n        //         data: [\n        //             {\n        //                 type: \"Team\",\n        //                 data: [\n        //                     { time: 0, value: 90 },\n        //                     { time: 1, value: 100 },\n        //                     { time: 2, value: 90 },\n        //                     { time: 3, value: 100 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 90 },\n        //                     { time: 7, value: 120 },\n        //                 ]\n        //             },\n        //             {\n        //                 type: \"Community\",\n        //                 data: [\n        //                     { time: 0, value: 70 },\n        //                     { time: 1, value: 110 },\n        //                     { time: 2, value: 80 },\n        //                     { time: 3, value: 190 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 100 },\n        //                     { time: 6, value: 70 },\n        //                     { time: 7, value: 150 },\n        //                 ]\n        //             }\n\n\n        //         ]\n        //     }\n        // ]\n        \n    }\n\n    initData() {\n        this.getNodes();\n        this.getEdges();\n\n    }\n\n    // 获取当前画布上的所有节点，保存节点原始 antv 数据和用户配置属性参数\n    getNodes() {\n\n        // 获取所有节点的 antv 相关数据，同时建立起不同节点类型的 label(用户设置的节点名字) -> id 的映射表\n        let nodes = this.graph.model.getNodes();\n        nodes.forEach(element => {\n            this.antvNodes.set(element.id, element);\n            \n            switch(element.getData().type) {\n                case \"Token\":\n                    this.tokenLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Stake\":\n                    this.action.stakeLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Unstake\":\n                    this.action.unstakeLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Vest\":\n                    this.action.vestLabelIDMap.set(element.label, element.id);\n                    break;\n                default:\n                    break;\n            }\n        });\n\n        console.log(\"nodes:\", this.antvNodes);\n\n        // 初始化 Token 节点对象并加入到 nodesInstance 中\n        for (let item of this.tokenLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.tokenData;\n            this.nodesInstance.set(item[1], new Token(item[0], nodeData.totalSupply, nodeData.allocations, nodeData.community));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 根据 stake 节点的 rewardPolicyFrom 参数，更新对应的 token 节点的 stakingPool 参数\n        // TODO 非常丑陋，如何优化？\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom)).communityPolicy.stakingPool++;\n        }\n\n        // 初始化 stake 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            let tokenInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom));\n            let rewardPolicy = {\n                // 此处 rewardTotal 指的是单个 stake 池子所能释放奖励的总量。其值取决于释放的 token 中设置的 Community Staking 总量除以可以释放该 token 的 stake 池总数  \n                rewardTotal: StandardNum(tokenInstance.communityPolicy.allocations.get(\"Staking\") * tokenInstance.allocationPercent.get(\"Community\") * tokenInstance.totalSupply / tokenInstance.communityPolicy.stakingPool),\n                rewardLifetime: tokenInstance.communityPolicy.stakingRewardLifetime,\n                rewardRefreshPeriod: tokenInstance.communityPolicy.stakingRewardRefreshPeriod,\n                rewardDefactor: tokenInstance.communityPolicy.stakingRewardDefactor,\n            };\n            this.nodesInstance.set(item[1], new Stake(item[0], rewardPolicy, nodeData.stakeAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 初始化 unstake 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.unstakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.unstakeData;\n            this.nodesInstance.set(item[1], new Unstake(item[0], nodeData.coolDownTime, nodeData.unstakeAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 初始化 vest 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.vestLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.vestData;\n            this.nodesInstance.set(item[1], new Vest(item[0], nodeData.vestAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n    }\n\n    // 获取当前画布上的所有边，保存边上用户配置的属性参数\n    getEdges() {\n        // let edges = this.graph.getEdges()\n        // edges.forEach(element => {\n        //     let src = element.getSourceNode().id;\n        //     let dst = element.getTargetNode().id;\n\n        //     let edgeData = element.getData().edgeData;\n        //     console.log(\"edges\", edgeData);\n\n        //     let edge = new Edge(src, dst, edgeData.distribution);\n        //     if (this.edgeMap.get(src) == undefined) {\n        //         this.edgeMap.set(src, new Map());\n        //     }\n        //     this.edgeMap.get(src).set(dst, edge);\n        // })\n    }\n\n    async start() {\n        while (this.curDay <= this.endDay) {\n            let step = this.scheduler.schedule();\n\n            if (step.endFlag == true) {\n                // 更新所有节点\n                this.nodesInstance.forEach(function(value, key) {\n                    value.update();\n                })\n                // 为数据可视化做准备，更新测算过程中每日的动态数据 \n                this.updateDailyData();\n\n                \n                // 每隔一段周期都暂停 5s\n                if (this.slot > 0 && this.curDay % this.slot == 0) {\n                    await Sleep(5000);\n                }\n                this.curDay++;\n                // 如果模型处于 Off / Pause 状态，直接跳出函数\n                if (this.status == 0 || this.status == 2) {\n                    return;\n                }\n\n                continue;\n            }\n\n            if (this.nodesInstance.get(step.curNode) == undefined) {\n                // log 报错提示: 不存在该节点\n                console.log(\"error:: cur node does not exist!\", step);\n                break ;\n            }\n\n            console.log(\"day:\", this.curDay);\n            // 执行当前节点的 run 方法\n            if (step.preNode == null) {\n                this.nodesInstance.get(step.curNode).run(null, this.curDay);\n            }\n            else {\n                this.nodesInstance.get(step.curNode).run(this.nodesInstance.get(step.preNode), this.curDay);\n            }\n\n        }\n\n        // 为数据可视化做准备，更新一次测算总体的数据，如 unstakeHistory, vestHistory 等\n        this.updateOverallData();\n        // log 提示: 测算运行完毕\n        return;\n    }\n\n    updateDailyData() {\n        for (let i = 0; i < this.data.length; i++) {\n            \n            // 更新 token 节点相关的 data\n            if (this.tokenLabelIDMap.has(this.data[i].type)) {\n                let tmpInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(this.data[i].type));\n\n                // this.data 的数据结构如下所示\n                // this.data:\n                // [\n                //     {\n                //         type: \"Token2\",\n                //         data: [\n                //             {\n                //                 type: \"Team\",\n                //                 data: [\n                //                     { time: 0, value: 60 },\n                //                     { time: 1, value: 80 },\n                //                     { time: 2, value: 90 },\n                //                     { time: 3, value: 80 },\n                //                     { time: 4, value: 90 },\n                //                     { time: 5, value: 110 },\n                //                     { time: 6, value: 120 },\n                //                     { time: 7, value: 140 },\n                //                 ]\n                //             }, // 参与者 data 域\n                //             {\n                //                 type: \"Community\",\n                //                 data: [\n                //                     { time: 0, value: 50 },\n                //                     { time: 1, value: 90 },\n                //                     { time: 2, value: 40 },\n                //                     { time: 3, value: 80 },\n                //                     { time: 4, value: 30 },\n                //                     { time: 5, value: 110 },\n                //                     { time: 6, value: 170 },\n                //                     { time: 7, value: 180 },\n                //                 ]\n                //             } // 参与者 data 域\n\n                //         ]\n                //     }, // 节点 data 域\n                // ]\n                // 对于每个节点，其节点的 data 域内会有不同的角色, 如 Team, Community 等; 但是节点 data 域是一个数组，由于将节点含有的角色数据插入 data 域数组的过程不是有序的所以不能直接根据下标就定位到某个角色，\n                // 所以此处需要保存一个映射 roleIdxMap, key 为角色, value 为该角色在节点 data 域数组内的下标，方便后续操作指定节点的指定角色 data 域\n                let roleIdxMap = new Map();\n                \n                // 根据节点 data 域中已包含的角色来初始化 roleIdxMap\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                // TODO 目前对于 token 节点只支持将 freeMoney 数据可视化\n                for (let item of tmpInstance.freeMoney) {\n                    // 如果 roleIdxMap 中还没有包含某个角色（也意味着节点 data 域中还未包含某个角色），则在节点 data 域中为该角色插入记录，同时将 role -> idx 的映射关系保存起来\n                    if (!roleIdxMap.has(item[0])) {\n                        let len = this.data[i].data.push({type: item[0], data:[]});\n                        roleIdxMap.set(item[0], len - 1);\n                    }\n                    // 往节点 data 域下的角色 data 域插入数据\n                    this.data[i].data[roleIdxMap.get(item[0])].data.push({time: String(this.curDay), value: item[1]});\n                }\n            } \n            // 更新 stake 节点相关的 data，代码逻辑和实现与上面对 token 节点的处理相同\n            else if (this.action.stakeLabelIDMap.has(this.data[i].type)) {\n                let tmpInstance = this.nodesInstance.get(this.action.stakeLabelIDMap.get(this.data[i].type));\n                let roleIdxMap = new Map();\n                \n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                // TODO 目前对于 stake 节点只支持将 rewardAllocated 数据可视化\n                for (let item of tmpInstance.rewardAllocated) {\n                    if (!roleIdxMap.has(item[0])) {\n                        let len = this.data[i].data.push({type: item[0], data:[]});\n                        roleIdxMap.set(item[0], len - 1);\n                    }\n                    this.data[i].data[roleIdxMap.get(item[0])].data.push({time: String(this.curDay), value: item[1]});\n                }\n            } \n            \n        }\n    }\n\n    // 为数据可视化功能服务，更新单次测算的总体数据，如 unstakeHistory, vestHistory 等\n    updateOverallData() {\n        for (let i = 0; i < this.data.length; i++) {\n            // 更新 unstake 节点相关的 data，代码逻辑和实现与上面对 token 节点的处理大体相似，稍有不同\n            if (this.action.unstakeLabelIDMap.has(this.data[i].type)) {\n                let originalHistory = this.nodesInstance.get(this.action.unstakeLabelIDMap.get(this.data[i].type)).unstakeHistory;\n                let orderedHistory = new Map();\n\n                // 由于 unstakeHistory 的插入顺序可能不是按天的顺序插入，所以需要重新按天排序\n                let keys = new Array();\n                for (let item of originalHistory) {\n                    keys.push(Number(item[0]));\n                }\n                keys.sort(function(a, b) {\n                    return Number(a) - Number(b);\n                });\n                for(let i = 0; i < keys.length; i++) {\n                    orderedHistory.set(Number(keys[i]), originalHistory.get(keys[i]));\n                }\n\n                let roleIdxMap = new Map();\n\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                    // roleTimedataIdxMap.set(this.data[i].data[j].type, new Map());\n                }\n\n                for (let item of orderedHistory) {\n                    // item: {key: 时间, value: {key:\"Team\", value: 100}}\n                    for (let item2 of item[1]) {\n                        // item2: {key: \"Team\", value: 100}\n                        if (!roleIdxMap.has(item2[0])) {\n                            let len = this.data[i].data.push({type: item2[0], data:[]});\n                            roleIdxMap.set(item2[0], len - 1);\n                        }\n                        this.data[i].data[roleIdxMap.get(item2[0])].data.push({time: String(item[0]), value: item2[1]});\n                    }\n                }\n\n            }\n            // 更新 vest 节点相关的 data, 代码逻辑和实现与上面对 token 节点的处理大体相似，稍有不同\n            else if (this.action.vestLabelIDMap.has(this.data[i].type)) {\n                let originalHistory = this.nodesInstance.get(this.action.vestLabelIDMap.get(this.data[i].type)).vestHistory;\n                let orderedHistory = new Map();\n\n                // 由于 vestHistory 的插入顺序不是按天的顺序插入，所以需要重新按天排序\n                let keys = new Array();\n                for (let item of originalHistory) {\n                    keys.push(item[0]);\n                }\n                keys.sort(function(a, b) {\n                    return a - b;\n                });\n                for(let i = 0; i < keys.length; i++) {\n                    orderedHistory.set(keys[i], originalHistory.get(keys[i]));\n                }\n\n                let roleIdxMap = new Map();\n\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                for (let item of orderedHistory) {\n                    // item: {key: 时间, value: {key:\"Team\", value: 100}}\n                    for (let item2 of item[1]) {\n                        // item2: {key: \"Team\", value: 100}\n                        if (!roleIdxMap.has(item2[0])) {\n                            let len = this.data[i].data.push({type: item2[0], data:[]});\n                            roleIdxMap.set(item2[0], len - 1);\n                        }\n                        this.data[i].data[roleIdxMap.get(item2[0])].data.push({time: String(item[0]), value: item2[1]});\n                    }\n                    \n                }\n            }\n        }\n    }\n\n    // 当模型从暂停状态重新启动测算时，用户可能对参数进行了修改，新的参数需要更新到模型中\n    selfUpdate(graph, endDay, slot) {\n        // 确保 endDay 大于当前\n        if (endDay < this.curDay) {\n            console.log(\"end day is illegal!\");\n            return;\n        }\n\n        this.endDay = endDay;\n        this.slot = slot;\n\n        let nodes = graph.model.getNodes();\n        nodes.forEach(element => {\n            this.antvNodes.set(element.id, element);\n        });\n\n        // 更新 Token 节点对象\n        for (let item of this.tokenLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.tokenData;\n            console.log(\"update token data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.totalSupply, nodeData.allocations, nodeData.community);\n        }\n\n        // 更新 stake 节点对象\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            console.log(\"update stake data:\", nodeData);\n            let tokenInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom));\n            console.log(\"update stake data rewardPolicyFrom:\", nodeData.rewardPolicyFrom);\n            let rewardPolicy = {\n                // 此处 rewardTotal 指的是单个 stake 池子所能释放奖励的总量。其值取决于释放的 token 中设置的 Community Staking 总量除以可以释放该 token 的 stake 池总数  \n                rewardTotal: StandardNum(tokenInstance.communityPolicy.allocations.get(\"Staking\") * tokenInstance.allocationPercent.get(\"Community\") * tokenInstance.totalSupply / tokenInstance.communityPolicy.stakingPool),\n                rewardLifetime: tokenInstance.communityPolicy.stakingRewardLifetime,\n                rewardRefreshPeriod: tokenInstance.communityPolicy.stakingRewardRefreshPeriod,\n                rewardDefactor: tokenInstance.communityPolicy.stakingRewardDefactor,\n            };\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], rewardPolicy, nodeData.stakeAmount);\n        }\n\n        // 更新 unstake 节点对象\n        for (let item of this.action.unstakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.unstakeData;\n            console.log(\"update unstake data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.coolDownTime, nodeData.unstakeAmount);\n        }\n\n        // 更新 vest 节点对象\n        for (let item of this.action.vestLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.vestData;\n            console.log(\"update vest data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.vestAmount);\n        }\n    }\n}"]}]}