{"remainingRequest":"/Users/wangxufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js!/Users/wangxufei/Desktop/FlowModel/node_modules/eslint-loader/index.js??ref--13-0!/Users/wangxufei/Desktop/FlowModel/src/graph/model.js","dependencies":[{"path":"/Users/wangxufei/Desktop/FlowModel/src/graph/model.js","mtime":1652163070427},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wangxufei/Desktop/FlowModel/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIudG8tZml4ZWQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvd2FuZ3h1ZmVpL0Rlc2t0b3AvRmxvd01vZGVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy93YW5neHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy93YW5neHVmZWkvRGVza3RvcC9GbG93TW9kZWwvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvd2FuZ3h1ZmVpL0Rlc2t0b3AvRmxvd01vZGVsL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCB7IFNjaGVkdWxlciB9IGZyb20gIi4vc2NoZWR1bGVyIjsKaW1wb3J0IHsgQWN0aW9uLCBTdGFrZSwgVW5zdGFrZSwgVmVzdCB9IGZyb20gIi4vYWN0aW9uIjsKaW1wb3J0IHsgVG9rZW4gfSBmcm9tICIuL3Rva2VuIjsKaW1wb3J0IHsgU2xlZXAgfSBmcm9tICIuLy4uL3V0aWxzL3NsZWVwIjsgLy8gdmFyIGlzUGF1c2VkID0gZmFsc2U7Ci8vIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7Ci8vICAgICAvLyBjb25zb2xlLmxvZygidGhyZWFkIG1lc3NhZ2U6IiwgZSk7Ci8vICAgICB2YXIgZGF0YSA9IGUuZGF0YTsKLy8gICAgIHN3aXRjaCAoZGF0YSkgewovLyAgICAgICBjYXNlICdwYXVzZSc6Ci8vICAgICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLS0tLXdvcmtlciBwYXVzZWQiKTsKLy8gICAgICAgICBpc1BhdXNlZCA9IHRydWU7Ci8vICAgICAgICAgYnJlYWs7Ci8vICAgICAgIGRlZmF1bHQ6Ci8vICAgICAgICAgLy8gc2VsZi5wb3N0TWVzc2FnZSgnVW5rbm93biBjb21tYW5kOiAnICsgZGF0YS5tc2cpOwovLyAgICAgfTsKLy8gICB9LCBmYWxzZSk7CgpleHBvcnQgdmFyIE1vZGVsID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBNb2RlbChncmFwaCwgZW5kRGF5LCBzbG90KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTW9kZWwpOwoKICAgIHRoaXMuZ3JhcGggPSBncmFwaDsgLy8gZW5kRGF5OiDmqKHlnovnmoTmtYvnrpfnu4jmraLml7bpl7QKCiAgICB0aGlzLmVuZERheSA9IGVuZERheTsgLy8gc2xvdDog5qih5Z6L5rWL566X55qE5YGc6aG/56qX5Y+j77yM5q+P6ZqU6L+Z5LiA5q615pe26Ze05qih5Z6L5rWL566X6L+H56iL5Lya5YGc6aG/IDVz77yM5pa55L6/5pON5L2c6ICF6L+b6KGM5LiL5LiA5q2l55qE6LCD5pW0CgogICAgdGhpcy5zbG90ID0gc2xvdDsgLy8gc3RhdHVzOiDmqKHlnovlpITkuo7lk6rkuKrnirbmgIHkuK0gMCAtIG9mZiwgMSAtIG9uLCAyIC0gcGF1c2UKCiAgICB0aGlzLnN0YXR1cyA9IDE7IC8vIGN1ckRheTog5qih5Z6L5rWL566X55qE5b2T5YmN5pe26Ze0CgogICAgdGhpcy5jdXJEYXkgPSAxOyAvLyBhbnR2Tm9kZXMg5L+d5a2Y55qE5piv5Y6f5aeLIGFudHYg5a6a5LmJ55qE6IqC54K55a+56LGhCiAgICAvLyBUT0RPIGFudHZOb2RlcyDmmK/lkKbku4Xku4XlnKjliJ3lp4vljJbnmoTml7blgJnnlKjliLDvvJ8KCiAgICB0aGlzLmFudHZOb2RlcyA9IG5ldyBNYXAoKTsgLy8gbm9kZXNJbnN0YW5jZSDkv53lrZjmiYDmnInoioLngrnlr7nosaHmlbDmja4gPGtleTogdG9rZW5JRCwgdmFsdWU6IG5vZGVDbGFzc0luc3RhbmNlPgoKICAgIHRoaXMubm9kZXNJbnN0YW5jZSA9IG5ldyBNYXAoKTsgLy8gYWN0aW9uIOWGheWMheWQqyBzdGFrZUxhYmVsSURNYXAsIHVuc3Rha2VMYWJlbElETWFwLCB2ZXN0TGFiZWxJRE1hcAoKICAgIHRoaXMuYWN0aW9uID0gbmV3IEFjdGlvbigpOyAvLyB0b2tlbkxhYmVsSURNYXAgPGtleTogbm9kZUxhYmVsLCB2YWx1ZTogbm9kZUlEPgoKICAgIHRoaXMudG9rZW5MYWJlbElETWFwID0gbmV3IE1hcCgpOyAvLyBFZGdlTWFwIDxrZXk6IHNvdXJjZUlELCB2YWx1ZTogPGtleTogdGFyZ2V0SUQsIHZhbHVlOiBFZGdlQ2xhc3NJbnN0YW5jZT4gPgoKICAgIHRoaXMuZWRnZU1hcCA9IG5ldyBNYXAoKTsgLy8gZGF0YTog5rWL566X5qih5Z6L5rWL566X6L+H56iL5Lit5Lqn55Sf55qE5pWw5o2uCgogICAgdGhpcy5kYXRhID0gW107CiAgICB0aGlzLmluaXREYXRhKCk7CiAgICB0aGlzLnNjaGVkdWxlciA9IG5ldyBTY2hlZHVsZXIoZ3JhcGgsIHRoaXMuYW50dk5vZGVzKTsgLy8gdGhpcy5kYXRhOiBbCiAgICAvLyAgICAgewogICAgLy8gICAgICAgICB0eXBlOiAiVG9rZW4yIiwKICAgIC8vICAgICAgICAgZGF0YTogWwogICAgLy8gICAgICAgICAgICAgewogICAgLy8gICAgICAgICAgICAgICAgIHR5cGU6ICJUZWFtIiwKICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBbCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMCwgdmFsdWU6IDYwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMSwgdmFsdWU6IDgwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMiwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMywgdmFsdWU6IDgwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNCwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNSwgdmFsdWU6IDExMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDYsIHZhbHVlOiAxMjAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA3LCB2YWx1ZTogMTQwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgXQogICAgLy8gICAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgICAgICB0eXBlOiAiQ29tbXVuaXR5IiwKICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBbCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMCwgdmFsdWU6IDUwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMSwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMiwgdmFsdWU6IDQwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMywgdmFsdWU6IDgwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNCwgdmFsdWU6IDMwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNSwgdmFsdWU6IDExMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDYsIHZhbHVlOiAxNzAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA3LCB2YWx1ZTogMTgwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgXQogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICBdCiAgICAvLyAgICAgfSwKICAgIC8vICAgICB7CiAgICAvLyAgICAgICAgIHR5cGU6ICJUb2tlbjEiLAogICAgLy8gICAgICAgICBkYXRhOiBbCiAgICAvLyAgICAgICAgICAgICB7CiAgICAvLyAgICAgICAgICAgICAgICAgdHlwZTogIlRlYW0iLAogICAgLy8gICAgICAgICAgICAgICAgIGRhdGE6IFsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAwLCB2YWx1ZTogOTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAxLCB2YWx1ZTogMTAwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMiwgdmFsdWU6IDkwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMywgdmFsdWU6IDEwMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDQsIHZhbHVlOiA5MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDUsIHZhbHVlOiAxMTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA2LCB2YWx1ZTogOTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA3LCB2YWx1ZTogMTIwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgXQogICAgLy8gICAgICAgICAgICAgfSwKICAgIC8vICAgICAgICAgICAgIHsKICAgIC8vICAgICAgICAgICAgICAgICB0eXBlOiAiQ29tbXVuaXR5IiwKICAgIC8vICAgICAgICAgICAgICAgICBkYXRhOiBbCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMCwgdmFsdWU6IDcwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogMSwgdmFsdWU6IDExMCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDIsIHZhbHVlOiA4MCB9LAogICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDMsIHZhbHVlOiAxOTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA0LCB2YWx1ZTogOTAgfSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA1LCB2YWx1ZTogMTAwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNiwgdmFsdWU6IDcwIH0sCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNywgdmFsdWU6IDE1MCB9LAogICAgLy8gICAgICAgICAgICAgICAgIF0KICAgIC8vICAgICAgICAgICAgIH0KICAgIC8vICAgICAgICAgXQogICAgLy8gICAgIH0KICAgIC8vIF0KICB9CgogIF9jcmVhdGVDbGFzcyhNb2RlbCwgW3sKICAgIGtleTogImluaXREYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0RGF0YSgpIHsKICAgICAgdGhpcy5nZXROb2RlcygpOwogICAgICB0aGlzLmdldEVkZ2VzKCk7CiAgICB9IC8vIOiOt+WPluW9k+WJjeeUu+W4g+S4iueahOaJgOacieiKgueCue+8jOS/neWtmOiKgueCueWOn+WniyBhbnR2IOaVsOaNruWSjOeUqOaIt+mFjee9ruWxnuaAp+WPguaVsAoKICB9LCB7CiAgICBrZXk6ICJnZXROb2RlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Tm9kZXMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvLyDojrflj5bmiYDmnInoioLngrnnmoQgYW50diDnm7jlhbPmlbDmja7vvIzlkIzml7blu7rnq4votbfkuI3lkIzoioLngrnnsbvlnovnmoQgbGFiZWwo55So5oi36K6+572u55qE6IqC54K55ZCN5a2XKSAtPiBpZCDnmoTmmKDlsITooagKICAgICAgdmFyIG5vZGVzID0gdGhpcy5ncmFwaC5tb2RlbC5nZXROb2RlcygpOwogICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgX3RoaXMuYW50dk5vZGVzLnNldChlbGVtZW50LmlkLCBlbGVtZW50KTsKCiAgICAgICAgc3dpdGNoIChlbGVtZW50LmdldERhdGEoKS50eXBlKSB7CiAgICAgICAgICBjYXNlICJUb2tlbiI6CiAgICAgICAgICAgIF90aGlzLnRva2VuTGFiZWxJRE1hcC5zZXQoZWxlbWVudC5sYWJlbCwgZWxlbWVudC5pZCk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJTdGFrZSI6CiAgICAgICAgICAgIF90aGlzLmFjdGlvbi5zdGFrZUxhYmVsSURNYXAuc2V0KGVsZW1lbnQubGFiZWwsIGVsZW1lbnQuaWQpOwoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAiVW5zdGFrZSI6CiAgICAgICAgICAgIF90aGlzLmFjdGlvbi51bnN0YWtlTGFiZWxJRE1hcC5zZXQoZWxlbWVudC5sYWJlbCwgZWxlbWVudC5pZCk7CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJWZXN0IjoKICAgICAgICAgICAgX3RoaXMuYWN0aW9uLnZlc3RMYWJlbElETWFwLnNldChlbGVtZW50LmxhYmVsLCBlbGVtZW50LmlkKTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnNvbGUubG9nKCJub2RlczoiLCB0aGlzLmFudHZOb2Rlcyk7IC8vIOWIneWni+WMliBUb2tlbiDoioLngrnlr7nosaHlubbliqDlhaXliLAgbm9kZXNJbnN0YW5jZSDkuK0KCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLnRva2VuTGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICB2YXIgYW50dk5vZGUgPSB0aGlzLmFudHZOb2Rlcy5nZXQoaXRlbVsxXSk7CiAgICAgICAgICB2YXIgbm9kZURhdGEgPSBhbnR2Tm9kZS5nZXREYXRhKCkubm9kZURhdGEudG9rZW5EYXRhOwogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLnNldChpdGVtWzFdLCBuZXcgVG9rZW4oaXRlbVswXSwgbm9kZURhdGEudG90YWxTdXBwbHksIG5vZGVEYXRhLmFsbG9jYXRpb25zLCBub2RlRGF0YS5jb21tdW5pdHkpKTsKICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKHsKICAgICAgICAgICAgdHlwZTogaXRlbVswXSwKICAgICAgICAgICAgZGF0YTogW10KICAgICAgICAgIH0pOwogICAgICAgIH0gLy8g5qC55o2uIHN0YWtlIOiKgueCueeahCByZXdhcmRQb2xpY3lGcm9tIOWPguaVsO+8jOabtOaWsOWvueW6lOeahCB0b2tlbiDoioLngrnnmoQgc3Rha2luZ1Bvb2wg5Y+C5pWwCiAgICAgICAgLy8gVE9ETyDpnZ7luLjkuJHpmYvvvIzlpoLkvZXkvJjljJbvvJ8KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi5zdGFrZUxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXAyOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtID0gX3N0ZXAyLnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGUgPSB0aGlzLmFudHZOb2Rlcy5nZXQoX2l0ZW1bMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGEgPSBfYW50dk5vZGUuZ2V0RGF0YSgpLm5vZGVEYXRhLnN0YWtlRGF0YTsKCiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHRoaXMudG9rZW5MYWJlbElETWFwLmdldChfbm9kZURhdGEucmV3YXJkUG9saWN5RnJvbSkpLmNvbW11bml0eVBvbGljeS5zdGFraW5nUG9vbCsrOwogICAgICAgIH0gLy8g5Yid5aeL5YyWIHN0YWtlIOiKgueCueWvueixoeW5tuWKoOWFpeWIsCBub2Rlc0luc3RhbmNlIOS4rQoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgIH0KCiAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24uc3Rha2VMYWJlbElETWFwKSwKICAgICAgICAgIF9zdGVwMzsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IzLnMoKTsgIShfc3RlcDMgPSBfaXRlcmF0b3IzLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfaXRlbTIgPSBfc3RlcDMudmFsdWU7CgogICAgICAgICAgdmFyIF9hbnR2Tm9kZTIgPSB0aGlzLmFudHZOb2Rlcy5nZXQoX2l0ZW0yWzFdKTsKCiAgICAgICAgICB2YXIgX25vZGVEYXRhMiA9IF9hbnR2Tm9kZTIuZ2V0RGF0YSgpLm5vZGVEYXRhLnN0YWtlRGF0YTsKCiAgICAgICAgICB2YXIgdG9rZW5JbnN0YW5jZSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy50b2tlbkxhYmVsSURNYXAuZ2V0KF9ub2RlRGF0YTIucmV3YXJkUG9saWN5RnJvbSkpOwogICAgICAgICAgdmFyIHJld2FyZFBvbGljeSA9IHsKICAgICAgICAgICAgLy8g5q2k5aSEIHJld2FyZFRvdGFsIOaMh+eahOaYr+WNleS4qiBzdGFrZSDmsaDlrZDmiYDog73ph4rmlL7lpZblirHnmoTmgLvph4/jgILlhbblgLzlj5blhrPkuo7ph4rmlL7nmoQgdG9rZW4g5Lit6K6+572u55qEIENvbW11bml0eSBTdGFraW5nIOaAu+mHj+mZpOS7peWPr+S7pemHiuaUvuivpSB0b2tlbiDnmoQgc3Rha2Ug5rGg5oC75pWwICAKICAgICAgICAgICAgcmV3YXJkVG90YWw6ICh0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5hbGxvY2F0aW9ucy5nZXQoIlN0YWtpbmciKSAqIHRva2VuSW5zdGFuY2UuYWxsb2NhdGlvblBlcmNlbnQuZ2V0KCJDb21tdW5pdHkiKSAqIHRva2VuSW5zdGFuY2UudG90YWxTdXBwbHkgLyB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUG9vbCkudG9GaXhlZCg0KSwKICAgICAgICAgICAgcmV3YXJkTGlmZXRpbWU6IHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdSZXdhcmRMaWZldGltZSwKICAgICAgICAgICAgcmV3YXJkUmVmcmVzaFBlcmlvZDogdG9rZW5JbnN0YW5jZS5jb21tdW5pdHlQb2xpY3kuc3Rha2luZ1Jld2FyZFJlZnJlc2hQZXJpb2QsCiAgICAgICAgICAgIHJld2FyZERlZmFjdG9yOiB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUmV3YXJkRGVmYWN0b3IKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2Uuc2V0KF9pdGVtMlsxXSwgbmV3IFN0YWtlKF9pdGVtMlswXSwgcmV3YXJkUG9saWN5LCBfbm9kZURhdGEyLnN0YWtlQW1vdW50KSk7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCh7CiAgICAgICAgICAgIHR5cGU6IF9pdGVtMlswXSwKICAgICAgICAgICAgZGF0YTogW10KICAgICAgICAgIH0pOwogICAgICAgIH0gLy8g5Yid5aeL5YyWIHVuc3Rha2Ug6IqC54K55a+56LGh5bm25Yqg5YWl5YiwIG5vZGVzSW5zdGFuY2Ug5LitCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IzLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IzLmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi51bnN0YWtlTGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDQ7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX2l0ZW0zID0gX3N0ZXA0LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGUzID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtM1sxXSk7CgogICAgICAgICAgdmFyIF9ub2RlRGF0YTMgPSBfYW50dk5vZGUzLmdldERhdGEoKS5ub2RlRGF0YS51bnN0YWtlRGF0YTsKCiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2Uuc2V0KF9pdGVtM1sxXSwgbmV3IFVuc3Rha2UoX2l0ZW0zWzBdLCBfbm9kZURhdGEzLmNvb2xEb3duVGltZSwgX25vZGVEYXRhMy51bnN0YWtlQW1vdW50KSk7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCh7CiAgICAgICAgICAgIHR5cGU6IF9pdGVtM1swXSwKICAgICAgICAgICAgZGF0YTogW10KICAgICAgICAgIH0pOwogICAgICAgIH0gLy8g5Yid5aeL5YyWIHZlc3Qg6IqC54K55a+56LGh5bm25Yqg5YWl5YiwIG5vZGVzSW5zdGFuY2Ug5LitCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I0LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjUgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi52ZXN0TGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDU7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX2l0ZW00ID0gX3N0ZXA1LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGU0ID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtNFsxXSk7CgogICAgICAgICAgdmFyIF9ub2RlRGF0YTQgPSBfYW50dk5vZGU0LmdldERhdGEoKS5ub2RlRGF0YS52ZXN0RGF0YTsKCiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2Uuc2V0KF9pdGVtNFsxXSwgbmV3IFZlc3QoX2l0ZW00WzBdLCBfbm9kZURhdGE0LnZlc3RBbW91bnQpKTsKICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKHsKICAgICAgICAgICAgdHlwZTogX2l0ZW00WzBdLAogICAgICAgICAgICBkYXRhOiBbXQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgfQogICAgfSAvLyDojrflj5blvZPliY3nlLvluIPkuIrnmoTmiYDmnInovrnvvIzkv53lrZjovrnkuIrnlKjmiLfphY3nva7nmoTlsZ7mgKflj4LmlbAKCiAgfSwgewogICAga2V5OiAiZ2V0RWRnZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVkZ2VzKCkgey8vIGxldCBlZGdlcyA9IHRoaXMuZ3JhcGguZ2V0RWRnZXMoKQogICAgICAvLyBlZGdlcy5mb3JFYWNoKGVsZW1lbnQgPT4gewogICAgICAvLyAgICAgbGV0IHNyYyA9IGVsZW1lbnQuZ2V0U291cmNlTm9kZSgpLmlkOwogICAgICAvLyAgICAgbGV0IGRzdCA9IGVsZW1lbnQuZ2V0VGFyZ2V0Tm9kZSgpLmlkOwogICAgICAvLyAgICAgbGV0IGVkZ2VEYXRhID0gZWxlbWVudC5nZXREYXRhKCkuZWRnZURhdGE7CiAgICAgIC8vICAgICBjb25zb2xlLmxvZygiZWRnZXMiLCBlZGdlRGF0YSk7CiAgICAgIC8vICAgICBsZXQgZWRnZSA9IG5ldyBFZGdlKHNyYywgZHN0LCBlZGdlRGF0YS5kaXN0cmlidXRpb24pOwogICAgICAvLyAgICAgaWYgKHRoaXMuZWRnZU1hcC5nZXQoc3JjKSA9PSB1bmRlZmluZWQpIHsKICAgICAgLy8gICAgICAgICB0aGlzLmVkZ2VNYXAuc2V0KHNyYywgbmV3IE1hcCgpKTsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIHRoaXMuZWRnZU1hcC5nZXQoc3JjKS5zZXQoZHN0LCBlZGdlKTsKICAgICAgLy8gfSkKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3N0YXJ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBzdGVwOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuY3VyRGF5IDw9IHRoaXMuZW5kRGF5KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0ZXAgPSB0aGlzLnNjaGVkdWxlci5zY2hlZHVsZSgpOwoKICAgICAgICAgICAgICAgIGlmICghKHN0ZXAuZW5kRmxhZyA9PSB0cnVlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOabtOaWsOaJgOacieiKgueCuQogICAgICAgICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgICAgICAgdmFsdWUudXBkYXRlKCk7CiAgICAgICAgICAgICAgICB9KTsgLy8g5Li65pWw5o2u5Y+v6KeG5YyW5YGa5YeG5aSH77yM5pu05paw5rWL566X6L+H56iL5Lit5q+P5pel55qE5Yqo5oCB5pWw5o2uIAoKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGFpbHlEYXRhKCk7IC8vIOavj+malOS4gOauteWRqOacn+mDveaaguWBnCA1cwoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuc2xvdCA+IDAgJiYgdGhpcy5jdXJEYXkgJSB0aGlzLnNsb3QgPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuIFNsZWVwKDUwMDApOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICB0aGlzLmN1ckRheSsrOyAvLyDlpoLmnpzmqKHlnovlpITkuo4gT2ZmIC8gUGF1c2Ug54q25oCB77yM55u05o6l6Lez5Ye65Ye95pWwCgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5zdGF0dXMgPT0gMCB8fCB0aGlzLnN0YXR1cyA9PSAyKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgiY29udGludWUiLCAwKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMubm9kZXNJbnN0YW5jZS5nZXQoc3RlcC5jdXJOb2RlKSA9PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gbG9nIOaKpemUmeaPkOekujog5LiN5a2Y5Zyo6K+l6IqC54K5CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZXJyb3I6OiBjdXIgbm9kZSBkb2VzIG5vdCBleGlzdCEiLCBzdGVwKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoImJyZWFrIiwgMTkpOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImRheToiLCB0aGlzLmN1ckRheSk7IC8vIOaJp+ihjOW9k+WJjeiKgueCueeahCBydW4g5pa55rOVCgogICAgICAgICAgICAgICAgaWYgKHN0ZXAucHJlTm9kZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5nZXQoc3RlcC5jdXJOb2RlKS5ydW4obnVsbCwgdGhpcy5jdXJEYXkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmdldChzdGVwLmN1ck5vZGUpLnJ1bih0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHN0ZXAucHJlTm9kZSksIHRoaXMuY3VyRGF5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgLy8g5Li65pWw5o2u5Y+v6KeG5YyW5YGa5YeG5aSH77yM5pu05paw5LiA5qyh5rWL566X5oC75L2T55qE5pWw5o2u77yM5aaCIHVuc3Rha2VIaXN0b3J5LCB2ZXN0SGlzdG9yeSDnrYkKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3ZlcmFsbERhdGEoKTsgLy8gbG9nIOaPkOekujog5rWL566X6L+Q6KGM5a6M5q+VCgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gc3RhcnQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGFydC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gc3RhcnQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVEYWlseURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZURhaWx5RGF0YSgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyDmm7TmlrAgdG9rZW4g6IqC54K555u45YWz55qEIGRhdGEKICAgICAgICBpZiAodGhpcy50b2tlbkxhYmVsSURNYXAuaGFzKHRoaXMuZGF0YVtpXS50eXBlKSkgewogICAgICAgICAgdmFyIHRtcEluc3RhbmNlID0gdGhpcy5ub2Rlc0luc3RhbmNlLmdldCh0aGlzLnRva2VuTGFiZWxJRE1hcC5nZXQodGhpcy5kYXRhW2ldLnR5cGUpKTsgLy8gdGhpcy5kYXRhIOeahOaVsOaNrue7k+aehOWmguS4i+aJgOekugogICAgICAgICAgLy8gdGhpcy5kYXRhOgogICAgICAgICAgLy8gWwogICAgICAgICAgLy8gICAgIHsKICAgICAgICAgIC8vICAgICAgICAgdHlwZTogIlRva2VuMiIsCiAgICAgICAgICAvLyAgICAgICAgIGRhdGE6IFsKICAgICAgICAgIC8vICAgICAgICAgICAgIHsKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB0eXBlOiAiVGVhbSIsCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgZGF0YTogWwogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDAsIHZhbHVlOiA2MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDEsIHZhbHVlOiA4MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDIsIHZhbHVlOiA5MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDMsIHZhbHVlOiA4MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDQsIHZhbHVlOiA5MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDUsIHZhbHVlOiAxMTAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA2LCB2YWx1ZTogMTIwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNywgdmFsdWU6IDE0MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgIF0KICAgICAgICAgIC8vICAgICAgICAgICAgIH0sIC8vIOWPguS4juiAhSBkYXRhIOWfnwogICAgICAgICAgLy8gICAgICAgICAgICAgewogICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHR5cGU6ICJDb21tdW5pdHkiLAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgIGRhdGE6IFsKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAwLCB2YWx1ZTogNTAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAxLCB2YWx1ZTogOTAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAyLCB2YWx1ZTogNDAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiAzLCB2YWx1ZTogODAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA0LCB2YWx1ZTogMzAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgeyB0aW1lOiA1LCB2YWx1ZTogMTEwIH0sCiAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHsgdGltZTogNiwgdmFsdWU6IDE3MCB9LAogICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB7IHRpbWU6IDcsIHZhbHVlOiAxODAgfSwKICAgICAgICAgIC8vICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAvLyAgICAgICAgICAgICB9IC8vIOWPguS4juiAhSBkYXRhIOWfnwogICAgICAgICAgLy8gICAgICAgICBdCiAgICAgICAgICAvLyAgICAgfSwgLy8g6IqC54K5IGRhdGEg5Z+fCiAgICAgICAgICAvLyBdCiAgICAgICAgICAvLyDlr7nkuo7mr4/kuKroioLngrnvvIzlhbboioLngrnnmoQgZGF0YSDln5/lhoXkvJrmnInkuI3lkIznmoTop5LoibIsIOWmgiBUZWFtLCBDb21tdW5pdHkg562JOyDkvYbmmK/oioLngrkgZGF0YSDln5/mmK/kuIDkuKrmlbDnu4TvvIznlLHkuo7lsIboioLngrnlkKvmnInnmoTop5LoibLmlbDmja7mj5LlhaUgZGF0YSDln5/mlbDnu4TnmoTov4fnqIvkuI3mmK/mnInluo/nmoTmiYDku6XkuI3og73nm7TmjqXmoLnmja7kuIvmoIflsLHlrprkvY3liLDmn5DkuKrop5LoibLvvIwKICAgICAgICAgIC8vIOaJgOS7peatpOWkhOmcgOimgeS/neWtmOS4gOS4quaYoOWwhCByb2xlSWR4TWFwLCBrZXkg5Li66KeS6ImyLCB2YWx1ZSDkuLror6Xop5LoibLlnKjoioLngrkgZGF0YSDln5/mlbDnu4TlhoXnmoTkuIvmoIfvvIzmlrnkvr/lkI7nu63mk43kvZzmjIflrproioLngrnnmoTmjIflrprop5LoibIgZGF0YSDln58KCiAgICAgICAgICB2YXIgcm9sZUlkeE1hcCA9IG5ldyBNYXAoKTsgLy8g5qC55o2u6IqC54K5IGRhdGEg5Z+f5Lit5bey5YyF5ZCr55qE6KeS6Imy5p2l5Yid5aeL5YyWIHJvbGVJZHhNYXAKCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuZGF0YVtpXS5kYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIHJvbGVJZHhNYXAuc2V0KHRoaXMuZGF0YVtpXS5kYXRhW2pdLnR5cGUsIGopOwogICAgICAgICAgfSAvLyBUT0RPIOebruWJjeWvueS6jiB0b2tlbiDoioLngrnlj6rmlK/mjIHlsIYgZnJlZU1vbmV5IOaVsOaNruWPr+inhuWMlgoKCiAgICAgICAgICB2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRtcEluc3RhbmNlLmZyZWVNb25leSksCiAgICAgICAgICAgICAgX3N0ZXA2OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBfc3RlcDYudmFsdWU7CgogICAgICAgICAgICAgIC8vIOWmguaenCByb2xlSWR4TWFwIOS4rei/mOayoeacieWMheWQq+afkOS4quinkuiJsu+8iOS5n+aEj+WRs+edgOiKgueCuSBkYXRhIOWfn+S4rei/mOacquWMheWQq+afkOS4quinkuiJsu+8ie+8jOWImeWcqOiKgueCuSBkYXRhIOWfn+S4reS4uuivpeinkuiJsuaPkuWFpeiusOW9le+8jOWQjOaXtuWwhiByb2xlIC0+IGlkeCDnmoTmmKDlsITlhbPns7vkv53lrZjotbfmnaUKICAgICAgICAgICAgICBpZiAoIXJvbGVJZHhNYXAuaGFzKGl0ZW1bMF0pKSB7CiAgICAgICAgICAgICAgICB2YXIgbGVuID0gdGhpcy5kYXRhW2ldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IGl0ZW1bMF0sCiAgICAgICAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJvbGVJZHhNYXAuc2V0KGl0ZW1bMF0sIGxlbiAtIDEpOwogICAgICAgICAgICAgIH0gLy8g5b6A6IqC54K5IGRhdGEg5Z+f5LiL55qE6KeS6ImyIGRhdGEg5Z+f5o+S5YWl5pWw5o2uCgoKICAgICAgICAgICAgICB0aGlzLmRhdGFbaV0uZGF0YVtyb2xlSWR4TWFwLmdldChpdGVtWzBdKV0uZGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgIHRpbWU6IFN0cmluZyh0aGlzLmN1ckRheSksCiAgICAgICAgICAgICAgICB2YWx1ZTogaXRlbVsxXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yNi5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3I2LmYoKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIOabtOaWsCBzdGFrZSDoioLngrnnm7jlhbPnmoQgZGF0Ye+8jOS7o+eggemAu+i+keWSjOWunueOsOS4juS4iumdouWvuSB0b2tlbiDoioLngrnnmoTlpITnkIbnm7jlkIwKICAgICAgICBlbHNlIGlmICh0aGlzLmFjdGlvbi5zdGFrZUxhYmVsSURNYXAuaGFzKHRoaXMuZGF0YVtpXS50eXBlKSkgewogICAgICAgICAgICB2YXIgX3RtcEluc3RhbmNlID0gdGhpcy5ub2Rlc0luc3RhbmNlLmdldCh0aGlzLmFjdGlvbi5zdGFrZUxhYmVsSURNYXAuZ2V0KHRoaXMuZGF0YVtpXS50eXBlKSk7CgogICAgICAgICAgICB2YXIgX3JvbGVJZHhNYXAgPSBuZXcgTWFwKCk7CgogICAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgdGhpcy5kYXRhW2ldLmRhdGEubGVuZ3RoOyBfaisrKSB7CiAgICAgICAgICAgICAgX3JvbGVJZHhNYXAuc2V0KHRoaXMuZGF0YVtpXS5kYXRhW19qXS50eXBlLCBfaik7CiAgICAgICAgICAgIH0gLy8gVE9ETyDnm67liY3lr7nkuo4gc3Rha2Ug6IqC54K55Y+q5pSv5oyB5bCGIHJld2FyZEFsbG9jYXRlZCDmlbDmja7lj6/op4bljJYKCgogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yNyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKF90bXBJbnN0YW5jZS5yZXdhcmRBbGxvY2F0ZWQpLAogICAgICAgICAgICAgICAgX3N0ZXA3OwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgdmFyIF9pdGVtNSA9IF9zdGVwNy52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoIV9yb2xlSWR4TWFwLmhhcyhfaXRlbTVbMF0pKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfbGVuID0gdGhpcy5kYXRhW2ldLmRhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogX2l0ZW01WzBdLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgX3JvbGVJZHhNYXAuc2V0KF9pdGVtNVswXSwgX2xlbiAtIDEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuZGF0YVtpXS5kYXRhW19yb2xlSWR4TWFwLmdldChfaXRlbTVbMF0pXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICB0aW1lOiBTdHJpbmcodGhpcy5jdXJEYXkpLAogICAgICAgICAgICAgICAgICB2YWx1ZTogX2l0ZW01WzFdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9pdGVyYXRvcjcuZShlcnIpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIF9pdGVyYXRvcjcuZigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVPdmVyYWxsRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlT3ZlcmFsbERhdGEoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5kYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8g5pu05pawIHVuc3Rha2Ug6IqC54K555u45YWz55qEIGRhdGHvvIzku6PnoIHpgLvovpHlkozlrp7njrDkuI7kuIrpnaLlr7kgdG9rZW4g6IqC54K555qE5aSE55CG5aSn5L2T55u45Ly877yM56iN5pyJ5LiN5ZCMCiAgICAgICAgaWYgKHRoaXMuYWN0aW9uLnVuc3Rha2VMYWJlbElETWFwLmhhcyh0aGlzLmRhdGFbaV0udHlwZSkpIHsKICAgICAgICAgIHZhciBvcmlnaW5hbEhpc3RvcnkgPSB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHRoaXMuYWN0aW9uLnVuc3Rha2VMYWJlbElETWFwLmdldCh0aGlzLmRhdGFbaV0udHlwZSkpLnVuc3Rha2VIaXN0b3J5OwogICAgICAgICAgdmFyIHJvbGVJZHhNYXAgPSBuZXcgTWFwKCk7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmRhdGFbaV0uZGF0YS5sZW5ndGg7IGorKykgewogICAgICAgICAgICByb2xlSWR4TWFwLnNldCh0aGlzLmRhdGFbaV0uZGF0YVtqXS50eXBlLCBqKTsgLy8gcm9sZVRpbWVkYXRhSWR4TWFwLnNldCh0aGlzLmRhdGFbaV0uZGF0YVtqXS50eXBlLCBuZXcgTWFwKCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3JpZ2luYWxIaXN0b3J5KSwKICAgICAgICAgICAgICBfc3RlcDg7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9zdGVwOC52YWx1ZTsKCiAgICAgICAgICAgICAgLy8gaXRlbToge2tleTog5pe26Ze0LCB2YWx1ZToge2tleToiVGVhbSIsIHZhbHVlOiAxMDB9fQogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3I5ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoaXRlbVsxXSksCiAgICAgICAgICAgICAgICAgIF9zdGVwOTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yOS5zKCk7ICEoX3N0ZXA5ID0gX2l0ZXJhdG9yOS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICAgIHZhciBpdGVtMiA9IF9zdGVwOS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgIC8vIGl0ZW0yOiB7a2V5OiAiVGVhbSIsIHZhbHVlOiAxMDB9CiAgICAgICAgICAgICAgICAgIGlmICghcm9sZUlkeE1hcC5oYXMoaXRlbTJbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRoaXMuZGF0YVtpXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogaXRlbTJbMF0sCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJvbGVJZHhNYXAuc2V0KGl0ZW0yWzBdLCBsZW4gLSAxKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhW2ldLmRhdGFbcm9sZUlkeE1hcC5nZXQoaXRlbTJbMF0pXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgIHRpbWU6IFN0cmluZyhpdGVtWzBdKSwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaXRlbTJbMV0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3I5LmUoZXJyKTsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yOS5mKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yOC5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3I4LmYoKTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIOabtOaWsCB2ZXN0IOiKgueCueebuOWFs+eahCBkYXRhLCDku6PnoIHpgLvovpHlkozlrp7njrDkuI7kuIrpnaLlr7kgdG9rZW4g6IqC54K555qE5aSE55CG5aSn5L2T55u45Ly877yM56iN5pyJ5LiN5ZCMCiAgICAgICAgZWxzZSBpZiAodGhpcy5hY3Rpb24udmVzdExhYmVsSURNYXAuaGFzKHRoaXMuZGF0YVtpXS50eXBlKSkgewogICAgICAgICAgICB2YXIgX29yaWdpbmFsSGlzdG9yeSA9IHRoaXMubm9kZXNJbnN0YW5jZS5nZXQodGhpcy5hY3Rpb24udmVzdExhYmVsSURNYXAuZ2V0KHRoaXMuZGF0YVtpXS50eXBlKSkudmVzdEhpc3Rvcnk7CiAgICAgICAgICAgIHZhciBvcmRlcmVkSGlzdG9yeSA9IG5ldyBNYXAoKTsgLy8g55Sx5LqOIHZlc3RIaXN0b3J5IOeahOaPkuWFpemhuuW6j+S4jeaYr+aMieWkqeeahOmhuuW6j+aPkuWFpe+8jOaJgOS7pemcgOimgemHjeaWsOaMieWkqeaOkuW6jwoKICAgICAgICAgICAgdmFyIGtleXMgPSBuZXcgQXJyYXkoKTsKCiAgICAgICAgICAgIHZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKF9vcmlnaW5hbEhpc3RvcnkpLAogICAgICAgICAgICAgICAgX3N0ZXAxMDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IxMC5zKCk7ICEoX3N0ZXAxMCA9IF9pdGVyYXRvcjEwLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgIHZhciBfaXRlbTYgPSBfc3RlcDEwLnZhbHVlOwogICAgICAgICAgICAgICAga2V5cy5wdXNoKF9pdGVtNlswXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3IxMC5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMTAuZigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBrZXlzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGtleXMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgb3JkZXJlZEhpc3Rvcnkuc2V0KGtleXNbX2ldLCBfb3JpZ2luYWxIaXN0b3J5LmdldChrZXlzW19pXSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JvbGVJZHhNYXAyID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgZm9yICh2YXIgX2oyID0gMDsgX2oyIDwgdGhpcy5kYXRhW2ldLmRhdGEubGVuZ3RoOyBfajIrKykgewogICAgICAgICAgICAgIF9yb2xlSWR4TWFwMi5zZXQodGhpcy5kYXRhW2ldLmRhdGFbX2oyXS50eXBlLCBfajIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2l0ZXJhdG9yMTEgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvcmRlcmVkSGlzdG9yeSksCiAgICAgICAgICAgICAgICBfc3RlcDExOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjExLnMoKTsgIShfc3RlcDExID0gX2l0ZXJhdG9yMTEubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgdmFyIF9pdGVtNyA9IF9zdGVwMTEudmFsdWU7CgogICAgICAgICAgICAgICAgLy8gaXRlbToge2tleTog5pe26Ze0LCB2YWx1ZToge2tleToiVGVhbSIsIHZhbHVlOiAxMDB9fQogICAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjEyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoX2l0ZW03WzFdKSwKICAgICAgICAgICAgICAgICAgICBfc3RlcDEyOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMTIucygpOyAhKF9zdGVwMTIgPSBfaXRlcmF0b3IxMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9pdGVtOCA9IF9zdGVwMTIudmFsdWU7CgogICAgICAgICAgICAgICAgICAgIC8vIGl0ZW0yOiB7a2V5OiAiVGVhbSIsIHZhbHVlOiAxMDB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfcm9sZUlkeE1hcDIuaGFzKF9pdGVtOFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBfbGVuMiA9IHRoaXMuZGF0YVtpXS5kYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBfaXRlbThbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBfcm9sZUlkeE1hcDIuc2V0KF9pdGVtOFswXSwgX2xlbjIgLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YVtpXS5kYXRhW19yb2xlSWR4TWFwMi5nZXQoX2l0ZW04WzBdKV0uZGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IFN0cmluZyhfaXRlbTdbMF0pLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IF9pdGVtOFsxXQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMTIuZShlcnIpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yMTIuZigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMTEuZShlcnIpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgIF9pdGVyYXRvcjExLmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICB9IC8vIOW9k+aooeWei+S7juaaguWBnOeKtuaAgemHjeaWsOWQr+WKqOa1i+eul+aXtu+8jOeUqOaIt+WPr+iDveWvueWPguaVsOi/m+ihjOS6huS/ruaUue+8jOaWsOeahOWPguaVsOmcgOimgeabtOaWsOWIsOaooeWei+S4rQoKICB9LCB7CiAgICBrZXk6ICJzZWxmVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxmVXBkYXRlKGdyYXBoLCBlbmREYXksIHNsb3QpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvLyDnoa7kv50gZW5kRGF5IOWkp+S6juW9k+WJjQogICAgICBpZiAoZW5kRGF5IDwgdGhpcy5jdXJEYXkpIHsKICAgICAgICBjb25zb2xlLmxvZygiZW5kIGRheSBpcyBpbGxlZ2FsISIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5lbmREYXkgPSBlbmREYXk7CiAgICAgIHRoaXMuc2xvdCA9IHNsb3Q7CiAgICAgIHZhciBub2RlcyA9IGdyYXBoLm1vZGVsLmdldE5vZGVzKCk7CiAgICAgIG5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICBfdGhpczIuYW50dk5vZGVzLnNldChlbGVtZW50LmlkLCBlbGVtZW50KTsKICAgICAgfSk7IC8vIOabtOaWsCBUb2tlbiDoioLngrnlr7nosaEKCiAgICAgIHZhciBfaXRlcmF0b3IxMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRoaXMudG9rZW5MYWJlbElETWFwKSwKICAgICAgICAgIF9zdGVwMTM7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMTMucygpOyAhKF9zdGVwMTMgPSBfaXRlcmF0b3IxMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgaXRlbSA9IF9zdGVwMTMudmFsdWU7CiAgICAgICAgICB2YXIgYW50dk5vZGUgPSB0aGlzLmFudHZOb2Rlcy5nZXQoaXRlbVsxXSk7CiAgICAgICAgICB2YXIgbm9kZURhdGEgPSBhbnR2Tm9kZS5nZXREYXRhKCkubm9kZURhdGEudG9rZW5EYXRhOwogICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSB0b2tlbiBkYXRhOiIsIG5vZGVEYXRhKTsKICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5nZXQoaXRlbVsxXSkuc2VsZlVwZGF0ZShpdGVtWzBdLCBub2RlRGF0YS50b3RhbFN1cHBseSwgbm9kZURhdGEuYWxsb2NhdGlvbnMsIG5vZGVEYXRhLmNvbW11bml0eSk7CiAgICAgICAgfSAvLyDmm7TmlrAgc3Rha2Ug6IqC54K55a+56LGhCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTMuZigpOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yMTQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi5zdGFrZUxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXAxNDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxNC5zKCk7ICEoX3N0ZXAxNCA9IF9pdGVyYXRvcjE0Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfaXRlbTkgPSBfc3RlcDE0LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGU1ID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtOVsxXSk7CgogICAgICAgICAgdmFyIF9ub2RlRGF0YTUgPSBfYW50dk5vZGU1LmdldERhdGEoKS5ub2RlRGF0YS5zdGFrZURhdGE7CgogICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSBzdGFrZSBkYXRhOiIsIF9ub2RlRGF0YTUpOwogICAgICAgICAgdmFyIHRva2VuSW5zdGFuY2UgPSB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KHRoaXMudG9rZW5MYWJlbElETWFwLmdldChfbm9kZURhdGE1LnJld2FyZFBvbGljeUZyb20pKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGUgc3Rha2UgZGF0YSByZXdhcmRQb2xpY3lGcm9tOiIsIF9ub2RlRGF0YTUucmV3YXJkUG9saWN5RnJvbSk7CiAgICAgICAgICB2YXIgcmV3YXJkUG9saWN5ID0gewogICAgICAgICAgICAvLyDmraTlpIQgcmV3YXJkVG90YWwg5oyH55qE5piv5Y2V5LiqIHN0YWtlIOaxoOWtkOaJgOiDvemHiuaUvuWlluWKseeahOaAu+mHj+OAguWFtuWAvOWPluWGs+S6jumHiuaUvueahCB0b2tlbiDkuK3orr7nva7nmoQgQ29tbXVuaXR5IFN0YWtpbmcg5oC76YeP6Zmk5Lul5Y+v5Lul6YeK5pS+6K+lIHRva2VuIOeahCBzdGFrZSDmsaDmgLvmlbAgIAogICAgICAgICAgICByZXdhcmRUb3RhbDogKHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LmFsbG9jYXRpb25zLmdldCgiU3Rha2luZyIpICogdG9rZW5JbnN0YW5jZS5hbGxvY2F0aW9uUGVyY2VudC5nZXQoIkNvbW11bml0eSIpICogdG9rZW5JbnN0YW5jZS50b3RhbFN1cHBseSAvIHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdQb29sKS50b0ZpeGVkKDQpLAogICAgICAgICAgICByZXdhcmRMaWZldGltZTogdG9rZW5JbnN0YW5jZS5jb21tdW5pdHlQb2xpY3kuc3Rha2luZ1Jld2FyZExpZmV0aW1lLAogICAgICAgICAgICByZXdhcmRSZWZyZXNoUGVyaW9kOiB0b2tlbkluc3RhbmNlLmNvbW11bml0eVBvbGljeS5zdGFraW5nUmV3YXJkUmVmcmVzaFBlcmlvZCwKICAgICAgICAgICAgcmV3YXJkRGVmYWN0b3I6IHRva2VuSW5zdGFuY2UuY29tbXVuaXR5UG9saWN5LnN0YWtpbmdSZXdhcmREZWZhY3RvcgogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMubm9kZXNJbnN0YW5jZS5nZXQoX2l0ZW05WzFdKS5zZWxmVXBkYXRlKF9pdGVtOVswXSwgcmV3YXJkUG9saWN5LCBfbm9kZURhdGE1LnN0YWtlQW1vdW50KTsKICAgICAgICB9IC8vIOabtOaWsCB1bnN0YWtlIOiKgueCueWvueixoQoKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMTQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjE0LmYoKTsKICAgICAgfQoKICAgICAgdmFyIF9pdGVyYXRvcjE1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5hY3Rpb24udW5zdGFrZUxhYmVsSURNYXApLAogICAgICAgICAgX3N0ZXAxNTsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IxNS5zKCk7ICEoX3N0ZXAxNSA9IF9pdGVyYXRvcjE1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfaXRlbTEwID0gX3N0ZXAxNS52YWx1ZTsKCiAgICAgICAgICB2YXIgX2FudHZOb2RlNiA9IHRoaXMuYW50dk5vZGVzLmdldChfaXRlbTEwWzFdKTsKCiAgICAgICAgICB2YXIgX25vZGVEYXRhNiA9IF9hbnR2Tm9kZTYuZ2V0RGF0YSgpLm5vZGVEYXRhLnVuc3Rha2VEYXRhOwoKICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGUgdW5zdGFrZSBkYXRhOiIsIF9ub2RlRGF0YTYpOwogICAgICAgICAgdGhpcy5ub2Rlc0luc3RhbmNlLmdldChfaXRlbTEwWzFdKS5zZWxmVXBkYXRlKF9pdGVtMTBbMF0sIF9ub2RlRGF0YTYuY29vbERvd25UaW1lLCBfbm9kZURhdGE2LnVuc3Rha2VBbW91bnQpOwogICAgICAgIH0gLy8g5pu05pawIHZlc3Qg6IqC54K55a+56LGhCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IxNS5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMTUuZigpOwogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yMTYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLmFjdGlvbi52ZXN0TGFiZWxJRE1hcCksCiAgICAgICAgICBfc3RlcDE2OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjE2LnMoKTsgIShfc3RlcDE2ID0gX2l0ZXJhdG9yMTYubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9pdGVtMTEgPSBfc3RlcDE2LnZhbHVlOwoKICAgICAgICAgIHZhciBfYW50dk5vZGU3ID0gdGhpcy5hbnR2Tm9kZXMuZ2V0KF9pdGVtMTFbMV0pOwoKICAgICAgICAgIHZhciBfbm9kZURhdGE3ID0gX2FudHZOb2RlNy5nZXREYXRhKCkubm9kZURhdGEudmVzdERhdGE7CgogICAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZSB2ZXN0IGRhdGE6IiwgX25vZGVEYXRhNyk7CiAgICAgICAgICB0aGlzLm5vZGVzSW5zdGFuY2UuZ2V0KF9pdGVtMTFbMV0pLnNlbGZVcGRhdGUoX2l0ZW0xMVswXSwgX25vZGVEYXRhNy52ZXN0QW1vdW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjE2LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IxNi5mKCk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBNb2RlbDsKfSgpOw=="},{"version":3,"sources":["/Users/wangxufei/Desktop/FlowModel/src/graph/model.js"],"names":["Scheduler","Action","Stake","Unstake","Vest","Token","Sleep","Model","graph","endDay","slot","status","curDay","antvNodes","Map","nodesInstance","action","tokenLabelIDMap","edgeMap","data","initData","scheduler","getNodes","getEdges","nodes","model","forEach","element","set","id","getData","type","label","stakeLabelIDMap","unstakeLabelIDMap","vestLabelIDMap","console","log","item","antvNode","get","nodeData","tokenData","totalSupply","allocations","community","push","stakeData","rewardPolicyFrom","communityPolicy","stakingPool","tokenInstance","rewardPolicy","rewardTotal","allocationPercent","toFixed","rewardLifetime","stakingRewardLifetime","rewardRefreshPeriod","stakingRewardRefreshPeriod","rewardDefactor","stakingRewardDefactor","stakeAmount","unstakeData","coolDownTime","unstakeAmount","vestData","vestAmount","step","schedule","endFlag","value","key","update","updateDailyData","curNode","undefined","preNode","run","updateOverallData","i","length","has","tmpInstance","roleIdxMap","j","freeMoney","len","time","String","rewardAllocated","originalHistory","unstakeHistory","item2","vestHistory","orderedHistory","keys","Array","sort","a","b","selfUpdate"],"mappings":"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","sourcesContent":["import { Scheduler } from \"./scheduler\";\nimport { Action, Stake, Unstake, Vest } from \"./action\";\nimport { Token } from \"./token\";\nimport { Sleep } from \"./../utils/sleep\";\n\n// var isPaused = false;\n// self.addEventListener('message', function (e) {\n//     // console.log(\"thread message:\", e);\n//     var data = e.data;\n//     switch (data) {\n//       case 'pause':\n//         console.log(\"---------------worker paused\");\n//         isPaused = true;\n//         break;\n//       default:\n//         // self.postMessage('Unknown command: ' + data.msg);\n//     };\n//   }, false);\n\nexport class Model {\n\n    constructor(graph, endDay, slot) {\n        this.graph = graph;\n        // endDay: 模型的测算终止时间\n        this.endDay = endDay;\n        // slot: 模型测算的停顿窗口，每隔这一段时间模型测算过程会停顿 5s，方便操作者进行下一步的调整\n        this.slot = slot;\n        // status: 模型处于哪个状态中 0 - off, 1 - on, 2 - pause\n        this.status = 1;\n        // curDay: 模型测算的当前时间\n        this.curDay = 1;\n        // antvNodes 保存的是原始 antv 定义的节点对象\n        // TODO antvNodes 是否仅仅在初始化的时候用到？\n        this.antvNodes = new Map();\n        // nodesInstance 保存所有节点对象数据 <key: tokenID, value: nodeClassInstance>\n        this.nodesInstance = new Map();\n        // action 内包含 stakeLabelIDMap, unstakeLabelIDMap, vestLabelIDMap\n        this.action = new Action();\n        // tokenLabelIDMap <key: nodeLabel, value: nodeID>\n        this.tokenLabelIDMap = new Map();\n        // EdgeMap <key: sourceID, value: <key: targetID, value: EdgeClassInstance> >\n        this.edgeMap = new Map();\n        // data: 测算模型测算过程中产生的数据\n        this.data = [];\n\n        this.initData();\n\n        this.scheduler = new Scheduler(graph, this.antvNodes);\n        \n        // this.data: [\n        //     {\n        //         type: \"Token2\",\n        //         data: [\n        //             {\n        //                 type: \"Team\",\n        //                 data: [\n        //                     { time: 0, value: 60 },\n        //                     { time: 1, value: 80 },\n        //                     { time: 2, value: 90 },\n        //                     { time: 3, value: 80 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 120 },\n        //                     { time: 7, value: 140 },\n        //                 ]\n        //             },\n        //             {\n        //                 type: \"Community\",\n        //                 data: [\n        //                     { time: 0, value: 50 },\n        //                     { time: 1, value: 90 },\n        //                     { time: 2, value: 40 },\n        //                     { time: 3, value: 80 },\n        //                     { time: 4, value: 30 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 170 },\n        //                     { time: 7, value: 180 },\n        //                 ]\n        //             }\n\n        //         ]\n        //     },\n        //     {\n        //         type: \"Token1\",\n        //         data: [\n        //             {\n        //                 type: \"Team\",\n        //                 data: [\n        //                     { time: 0, value: 90 },\n        //                     { time: 1, value: 100 },\n        //                     { time: 2, value: 90 },\n        //                     { time: 3, value: 100 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 110 },\n        //                     { time: 6, value: 90 },\n        //                     { time: 7, value: 120 },\n        //                 ]\n        //             },\n        //             {\n        //                 type: \"Community\",\n        //                 data: [\n        //                     { time: 0, value: 70 },\n        //                     { time: 1, value: 110 },\n        //                     { time: 2, value: 80 },\n        //                     { time: 3, value: 190 },\n        //                     { time: 4, value: 90 },\n        //                     { time: 5, value: 100 },\n        //                     { time: 6, value: 70 },\n        //                     { time: 7, value: 150 },\n        //                 ]\n        //             }\n\n\n        //         ]\n        //     }\n        // ]\n        \n    }\n\n    initData() {\n        this.getNodes();\n        this.getEdges();\n\n    }\n\n    // 获取当前画布上的所有节点，保存节点原始 antv 数据和用户配置属性参数\n    getNodes() {\n\n        // 获取所有节点的 antv 相关数据，同时建立起不同节点类型的 label(用户设置的节点名字) -> id 的映射表\n        let nodes = this.graph.model.getNodes();\n        nodes.forEach(element => {\n            this.antvNodes.set(element.id, element);\n            \n            switch(element.getData().type) {\n                case \"Token\":\n                    this.tokenLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Stake\":\n                    this.action.stakeLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Unstake\":\n                    this.action.unstakeLabelIDMap.set(element.label, element.id);\n                    break;\n                case \"Vest\":\n                    this.action.vestLabelIDMap.set(element.label, element.id);\n                    break;\n                default:\n                    break;\n            }\n        });\n\n        console.log(\"nodes:\", this.antvNodes);\n\n        // 初始化 Token 节点对象并加入到 nodesInstance 中\n        for (let item of this.tokenLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.tokenData;\n            this.nodesInstance.set(item[1], new Token(item[0], nodeData.totalSupply, nodeData.allocations, nodeData.community));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 根据 stake 节点的 rewardPolicyFrom 参数，更新对应的 token 节点的 stakingPool 参数\n        // TODO 非常丑陋，如何优化？\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom)).communityPolicy.stakingPool++;\n        }\n\n        // 初始化 stake 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            let tokenInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom));\n            let rewardPolicy = {\n                // 此处 rewardTotal 指的是单个 stake 池子所能释放奖励的总量。其值取决于释放的 token 中设置的 Community Staking 总量除以可以释放该 token 的 stake 池总数  \n                rewardTotal: (tokenInstance.communityPolicy.allocations.get(\"Staking\") * tokenInstance.allocationPercent.get(\"Community\") * tokenInstance.totalSupply / tokenInstance.communityPolicy.stakingPool).toFixed(4),\n                rewardLifetime: tokenInstance.communityPolicy.stakingRewardLifetime,\n                rewardRefreshPeriod: tokenInstance.communityPolicy.stakingRewardRefreshPeriod,\n                rewardDefactor: tokenInstance.communityPolicy.stakingRewardDefactor,\n            };\n            this.nodesInstance.set(item[1], new Stake(item[0], rewardPolicy, nodeData.stakeAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 初始化 unstake 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.unstakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.unstakeData;\n            this.nodesInstance.set(item[1], new Unstake(item[0], nodeData.coolDownTime, nodeData.unstakeAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n        // 初始化 vest 节点对象并加入到 nodesInstance 中\n        for (let item of this.action.vestLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.vestData;\n            this.nodesInstance.set(item[1], new Vest(item[0], nodeData.vestAmount));\n            this.data.push({type: item[0], data: []});\n        }\n\n    }\n\n    // 获取当前画布上的所有边，保存边上用户配置的属性参数\n    getEdges() {\n        // let edges = this.graph.getEdges()\n        // edges.forEach(element => {\n        //     let src = element.getSourceNode().id;\n        //     let dst = element.getTargetNode().id;\n\n        //     let edgeData = element.getData().edgeData;\n        //     console.log(\"edges\", edgeData);\n\n        //     let edge = new Edge(src, dst, edgeData.distribution);\n        //     if (this.edgeMap.get(src) == undefined) {\n        //         this.edgeMap.set(src, new Map());\n        //     }\n        //     this.edgeMap.get(src).set(dst, edge);\n        // })\n    }\n\n    async start() {\n        while (this.curDay <= this.endDay) {\n            let step = this.scheduler.schedule();\n\n            if (step.endFlag == true) {\n                // 更新所有节点\n                this.nodesInstance.forEach(function(value, key) {\n                    value.update();\n                })\n                // 为数据可视化做准备，更新测算过程中每日的动态数据 \n                this.updateDailyData();\n\n                \n                // 每隔一段周期都暂停 5s\n                if (this.slot > 0 && this.curDay % this.slot == 0) {\n                    await Sleep(5000);\n                }\n                this.curDay++;\n                // 如果模型处于 Off / Pause 状态，直接跳出函数\n                if (this.status == 0 || this.status == 2) {\n                    return;\n                }\n\n                continue;\n            }\n\n            if (this.nodesInstance.get(step.curNode) == undefined) {\n                // log 报错提示: 不存在该节点\n                console.log(\"error:: cur node does not exist!\", step);\n                break ;\n            }\n\n            console.log(\"day:\", this.curDay);\n            // 执行当前节点的 run 方法\n            if (step.preNode == null) {\n                this.nodesInstance.get(step.curNode).run(null, this.curDay);\n            }\n            else {\n                this.nodesInstance.get(step.curNode).run(this.nodesInstance.get(step.preNode), this.curDay);\n            }\n\n        }\n\n        // 为数据可视化做准备，更新一次测算总体的数据，如 unstakeHistory, vestHistory 等\n        this.updateOverallData();\n        // log 提示: 测算运行完毕\n        return;\n    }\n\n    updateDailyData() {\n        for (let i = 0; i < this.data.length; i++) {\n            \n            // 更新 token 节点相关的 data\n            if (this.tokenLabelIDMap.has(this.data[i].type)) {\n                let tmpInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(this.data[i].type));\n\n                // this.data 的数据结构如下所示\n                // this.data:\n                // [\n                //     {\n                //         type: \"Token2\",\n                //         data: [\n                //             {\n                //                 type: \"Team\",\n                //                 data: [\n                //                     { time: 0, value: 60 },\n                //                     { time: 1, value: 80 },\n                //                     { time: 2, value: 90 },\n                //                     { time: 3, value: 80 },\n                //                     { time: 4, value: 90 },\n                //                     { time: 5, value: 110 },\n                //                     { time: 6, value: 120 },\n                //                     { time: 7, value: 140 },\n                //                 ]\n                //             }, // 参与者 data 域\n                //             {\n                //                 type: \"Community\",\n                //                 data: [\n                //                     { time: 0, value: 50 },\n                //                     { time: 1, value: 90 },\n                //                     { time: 2, value: 40 },\n                //                     { time: 3, value: 80 },\n                //                     { time: 4, value: 30 },\n                //                     { time: 5, value: 110 },\n                //                     { time: 6, value: 170 },\n                //                     { time: 7, value: 180 },\n                //                 ]\n                //             } // 参与者 data 域\n\n                //         ]\n                //     }, // 节点 data 域\n                // ]\n                // 对于每个节点，其节点的 data 域内会有不同的角色, 如 Team, Community 等; 但是节点 data 域是一个数组，由于将节点含有的角色数据插入 data 域数组的过程不是有序的所以不能直接根据下标就定位到某个角色，\n                // 所以此处需要保存一个映射 roleIdxMap, key 为角色, value 为该角色在节点 data 域数组内的下标，方便后续操作指定节点的指定角色 data 域\n                let roleIdxMap = new Map();\n                \n                // 根据节点 data 域中已包含的角色来初始化 roleIdxMap\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                // TODO 目前对于 token 节点只支持将 freeMoney 数据可视化\n                for (let item of tmpInstance.freeMoney) {\n                    // 如果 roleIdxMap 中还没有包含某个角色（也意味着节点 data 域中还未包含某个角色），则在节点 data 域中为该角色插入记录，同时将 role -> idx 的映射关系保存起来\n                    if (!roleIdxMap.has(item[0])) {\n                        let len = this.data[i].data.push({type: item[0], data:[]});\n                        roleIdxMap.set(item[0], len - 1);\n                    }\n                    // 往节点 data 域下的角色 data 域插入数据\n                    this.data[i].data[roleIdxMap.get(item[0])].data.push({time: String(this.curDay), value: item[1]});\n                }\n            } \n            // 更新 stake 节点相关的 data，代码逻辑和实现与上面对 token 节点的处理相同\n            else if (this.action.stakeLabelIDMap.has(this.data[i].type)) {\n                let tmpInstance = this.nodesInstance.get(this.action.stakeLabelIDMap.get(this.data[i].type));\n                let roleIdxMap = new Map();\n                \n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                // TODO 目前对于 stake 节点只支持将 rewardAllocated 数据可视化\n                for (let item of tmpInstance.rewardAllocated) {\n                    if (!roleIdxMap.has(item[0])) {\n                        let len = this.data[i].data.push({type: item[0], data:[]});\n                        roleIdxMap.set(item[0], len - 1);\n                    }\n                    this.data[i].data[roleIdxMap.get(item[0])].data.push({time: String(this.curDay), value: item[1]});\n                }\n            } \n            \n        }\n    }\n\n    updateOverallData() {\n        for (let i = 0; i < this.data.length; i++) {\n            // 更新 unstake 节点相关的 data，代码逻辑和实现与上面对 token 节点的处理大体相似，稍有不同\n            if (this.action.unstakeLabelIDMap.has(this.data[i].type)) {\n                let originalHistory = this.nodesInstance.get(this.action.unstakeLabelIDMap.get(this.data[i].type)).unstakeHistory;\n                let roleIdxMap = new Map();\n\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                    // roleTimedataIdxMap.set(this.data[i].data[j].type, new Map());\n                }\n\n                for (let item of originalHistory) {\n                    // item: {key: 时间, value: {key:\"Team\", value: 100}}\n                    for (let item2 of item[1]) {\n                        // item2: {key: \"Team\", value: 100}\n                        if (!roleIdxMap.has(item2[0])) {\n                            let len = this.data[i].data.push({type: item2[0], data:[]});\n                            roleIdxMap.set(item2[0], len - 1);\n                        }\n                        this.data[i].data[roleIdxMap.get(item2[0])].data.push({time: String(item[0]), value: item2[1]});\n                    }\n                    \n                }\n\n            }\n            // 更新 vest 节点相关的 data, 代码逻辑和实现与上面对 token 节点的处理大体相似，稍有不同\n            else if (this.action.vestLabelIDMap.has(this.data[i].type)) {\n                let originalHistory = this.nodesInstance.get(this.action.vestLabelIDMap.get(this.data[i].type)).vestHistory;\n                let orderedHistory = new Map();\n\n                // 由于 vestHistory 的插入顺序不是按天的顺序插入，所以需要重新按天排序\n                let keys = new Array();\n                for (let item of originalHistory) {\n                    keys.push(item[0]);\n                }\n                keys.sort(function(a, b) {\n                    return a - b;\n                });\n                for(let i = 0; i < keys.length; i++) {\n                    orderedHistory.set(keys[i], originalHistory.get(keys[i]));\n                }\n\n                let roleIdxMap = new Map();\n\n                for (let j = 0; j < this.data[i].data.length; j++) {\n                    roleIdxMap.set(this.data[i].data[j].type, j);\n                }\n\n                for (let item of orderedHistory) {\n                    // item: {key: 时间, value: {key:\"Team\", value: 100}}\n                    for (let item2 of item[1]) {\n                        // item2: {key: \"Team\", value: 100}\n                        if (!roleIdxMap.has(item2[0])) {\n                            let len = this.data[i].data.push({type: item2[0], data:[]});\n                            roleIdxMap.set(item2[0], len - 1);\n                        }\n                        this.data[i].data[roleIdxMap.get(item2[0])].data.push({time: String(item[0]), value: item2[1]});\n                    }\n                    \n                }\n            }\n        }\n    }\n\n    // 当模型从暂停状态重新启动测算时，用户可能对参数进行了修改，新的参数需要更新到模型中\n    selfUpdate(graph, endDay, slot) {\n        // 确保 endDay 大于当前\n        if (endDay < this.curDay) {\n            console.log(\"end day is illegal!\");\n            return;\n        }\n\n        this.endDay = endDay;\n        this.slot = slot;\n\n        let nodes = graph.model.getNodes();\n        nodes.forEach(element => {\n            this.antvNodes.set(element.id, element);\n        });\n\n        // 更新 Token 节点对象\n        for (let item of this.tokenLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.tokenData;\n            console.log(\"update token data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.totalSupply, nodeData.allocations, nodeData.community);\n        }\n\n        // 更新 stake 节点对象\n        for (let item of this.action.stakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.stakeData;\n            console.log(\"update stake data:\", nodeData);\n            let tokenInstance = this.nodesInstance.get(this.tokenLabelIDMap.get(nodeData.rewardPolicyFrom));\n            console.log(\"update stake data rewardPolicyFrom:\", nodeData.rewardPolicyFrom);\n            let rewardPolicy = {\n                // 此处 rewardTotal 指的是单个 stake 池子所能释放奖励的总量。其值取决于释放的 token 中设置的 Community Staking 总量除以可以释放该 token 的 stake 池总数  \n                rewardTotal: (tokenInstance.communityPolicy.allocations.get(\"Staking\") * tokenInstance.allocationPercent.get(\"Community\") * tokenInstance.totalSupply / tokenInstance.communityPolicy.stakingPool).toFixed(4),\n                rewardLifetime: tokenInstance.communityPolicy.stakingRewardLifetime,\n                rewardRefreshPeriod: tokenInstance.communityPolicy.stakingRewardRefreshPeriod,\n                rewardDefactor: tokenInstance.communityPolicy.stakingRewardDefactor,\n            };\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], rewardPolicy, nodeData.stakeAmount);\n        }\n\n        // 更新 unstake 节点对象\n        for (let item of this.action.unstakeLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.unstakeData;\n            console.log(\"update unstake data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.coolDownTime, nodeData.unstakeAmount);\n        }\n\n        // 更新 vest 节点对象\n        for (let item of this.action.vestLabelIDMap) {\n            let antvNode = this.antvNodes.get(item[1]);\n            let nodeData = antvNode.getData().nodeData.vestData;\n            console.log(\"update vest data:\", nodeData);\n            this.nodesInstance.get(item[1]).selfUpdate(item[0], nodeData.vestAmount);\n        }\n    }\n}"]}]}