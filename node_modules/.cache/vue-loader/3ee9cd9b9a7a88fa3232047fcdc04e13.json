{"remainingRequest":"/Users/xufei/Desktop/FlowModel/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xufei/Desktop/FlowModel/src/components/create/RightToolsNavbar.vue?vue&type=style&index=0&id=5ed097fc&lang=scss&scoped=true&","dependencies":[{"path":"/Users/xufei/Desktop/FlowModel/src/components/create/RightToolsNavbar.vue","mtime":1653708835745},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/css-loader/dist/cjs.js","mtime":1653708689646},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1653708694637},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/postcss-loader/src/index.js","mtime":1653708693104},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/sass-loader/dist/cjs.js","mtime":1653708694028},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/cache-loader/dist/cjs.js","mtime":1653708689072},{"path":"/Users/xufei/Desktop/FlowModel/node_modules/vue-loader/lib/index.js","mtime":1653708694636}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoudG9wLWNvbnRhaW5lciB7CiAgLy9oZWlnaHQ6IDUwcHg7CiAgcG9zaXRpb246IGZpeGVkOwogIGhlaWdodDogY2FsYygxMDAlIC0gMTgwcHgpOwogIHdpZHRoOiAzMDBweDsKICB0b3A6IDEyMHB4OwogIHJpZ2h0OiBjYWxjKDEwMCUgLSAoMTAwJSAtIDI1MHB4KSAtIDE5NXB4KTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmOwogIG92ZXJmbG93OiBzY3JvbGw7CiAgYm9yZGVyLXJhZGl1czogMzBweDsKICBib3JkZXI6IDIuNXB4IHNvbGlkIHJnYigyMzIsIDIzMSwgMjMxKTsKICBib3gtc2hhZG93OiAwIDAgMnB4IHJnYmEoMjI2LCAyMjYsIDIyNiwgMC44KTsKCiAgLnRvb2wtYmFyIHsKICAgIG1hcmdpbi10b3A6IDEwcHg7CiAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgaDQgewogICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgbWFyZ2luLXRvcDogMzBweDsKICAgIH0KICAgIGkgewogICAgICBtYXJnaW46IDEwcHg7CiAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgY29sb3I6ICM1NTU1NTU7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICY6aG92ZXIgewogICAgICAgIC8vIGNvbG9yOiAjOWE5YTljOwogICAgICAgIGNvbG9yOiAjNDA5ZWZmOwogICAgICB9CiAgICB9CiAgfQogIC5jb25maWctZGF0YS1ib3ggewogICAgbWFyZ2luLXRvcDogNDBweDsKICAgIGg0IHsKICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7CiAgICB9CiAgICAuY29uZmlnLWRhdGEtaW5wdXQgewogICAgICB3aWR0aDogMjAwcHg7CiAgICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogICAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgfQogICAgLmRheS1zbGlkZXIgewogICAgICBtYXJnaW4tbGVmdDogMTVweDsKICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgd2lkdGg6IDI1MHB4OwogICAgICAvZGVlcC8gLmVsLXNsaWRlcl9fYmFyIHsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoOTQsIDkxLCA5MSk7CiAgICAgIH0KICAgICAgL2RlZXAvIC5lbC1zbGlkZXJfX2J1dHRvbiB7CiAgICAgICAgYm9yZGVyOiAycHggc29saWQgcmdiKDk0LCA5MSwgOTEpOwogICAgICAgIHRyYW5zaXRpb246IDBzOwogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["RightToolsNavbar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RightToolsNavbar.vue","sourceRoot":"src/components/create","sourcesContent":["<template >\n  <div class=\"top-container\">\n    <!-- 工具栏 -->\n    <div class=\"tool-bar\">\n      <h4>Tools</h4>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Enlarge\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"ZOOM_GRAPH('up')\" class=\"el-icon-zoom-in\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Lessen\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"ZOOM_GRAPH('down')\" class=\"el-icon-zoom-out\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Focus canvas \"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"POSITIONING_GRAPH()\" class=\"el-icon-full-screen\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Undo operation\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"UNDO_GRAPH()\" class=\"el-icon-back\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Redo operation\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"REDO_GRAPH()\" class=\"el-icon-right\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Download model\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"saveGraphToPNG()\" class=\"el-icon-camera-solid\"></i>\n      </el-tooltip>\n\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Remove cells \"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"REMOVE_CELLS()\" class=\"el-icon-delete\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Start simulation\"\n        placement=\"bottom\"\n        effect=\"light\"\n        v-if=\"nowait\"\n      >\n        <i @click=\"startSimulation()\" class=\"el-icon-video-play\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Start simulation\"\n        placement=\"bottom\"\n        effect=\"light\"\n        v-else\n      >\n        <i class=\"el-icon-loading\"></i>\n      </el-tooltip>\n\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"Pause simulation\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"pauseSimulation()\" class=\"el-icon-video-pause\"></i>\n      </el-tooltip>\n      <el-tooltip\n        class=\"tooltip\"\n        content=\"End simulation\"\n        placement=\"bottom\"\n        effect=\"light\"\n      >\n        <i @click=\"endSimulation()\" class=\"el-icon-circle-close\"></i>\n      </el-tooltip>\n      <!-- <el-tooltip\n          class=\"tooltip\"\n          content=\"Upload existing models\"\n          placement=\"bottom\"\n          effect=\"light\"\n        >\n          <i @click=\"uploadGraph()\" class=\"el-icon-upload2\"></i>\n        </el-tooltip>\n        <el-tooltip\n          class=\"tooltip\"\n          content=\"Download model\"\n          placement=\"bottom\"\n          effect=\"light\"\n        >\n          <i @click=\"downloadGraph()\" class=\"el-icon-download\"></i>\n        </el-tooltip> -->\n    </div>\n\n    <el-divider></el-divider>\n\n    <!-- 系统参数栏 -->\n    <div class=\"config-data-box\">\n      <h4>Date Configuration</h4>\n      <!-- <span>Simulation Days</span> -->\n\n      <!--  <el-input\n          size=\"mini\"\n          class=\"config-data-input\"\n          v-model=\"currentSimulationDays\"\n          placeholder=\"\"\n          :disabled=\"modifyDisabled\"\n        ></el-input> -->\n\n      <span class=\"config-data-input\">Simulation Days</span>\n      <!-- <el-slider\n          v-model=\"configData.simulationDays\"\n          class=\"day-slider\"\n          :min=\"1\"\n          :max=\"20000\"\n          :step=\"1\"\n          :change=\"modifyConfigData()\"\n        ></el-slider> -->\n\n      <el-slider\n        v-model=\"configData.simulationDays\"\n        class=\"day-slider\"\n        :min=\"1\"\n        :max=\"20000\"\n        :step=\"1\"\n        :show-input=\"true\"\n        input-size=\"mini\"\n        :change=\"modifyConfigData()\"\n      ></el-slider>\n      <span class=\"config-data-input\">Simulation Slot</span>\n      <!-- <el-slider\n\n        <el-slider\n          v-model=\"configData.simulationDays\"\n          class=\"day-slider\"\n          :min=\"1\"\n          :max=\"20000\"\n          :step=\"1\"\n          show-input\n          input-size=\"mini\"\n          :change=\"modifyConfigData()\"\n        ></el-slider>\n        <span class=\"config-data-input\">Simulation Slot</span>\n\n        <el-slider\n          v-model=\"configData.simulationSlot\"\n          class=\"day-slider\"\n          :min=\"1\"\n          :max=\"5000\"\n          :step=\"1\"\n          show-input\n          input-size=\"mini\"\n          :change=\"modifyConfigData()\"\n        ></el-slider> -->\n\n      <el-slider\n        v-model=\"configData.simulationSlot\"\n        class=\"day-slider\"\n        :min=\"1\"\n        :max=\"5000\"\n        :step=\"1\"\n        show-input\n        input-size=\"mini\"\n        :change=\"modifyConfigData()\"\n      ></el-slider>\n      <span class=\"config-data-input\">Current Day: </span>\n      <span v-text=\"getModelTime()\"></span>\n\n      <!-- <div class=\"config-data-input\">Current Day\n          <div v-text=\"getModelTime()\"></div>\n        </div> -->\n    </div>\n    <!-- 系统参数修改按钮 -->\n    <!-- <div class=\"config-button\">\n        <div class=\"setting\">\n          <i\n            class=\"el-icon-setting\"\n            @click=\"modifyDisabled = !modifyDisabled\"\n            v-if=\"modifyDisabled\"\n          ></i>\n          <i\n            class=\"el-icon-success\"\n            @click=\"modifyConfigData()\"\n            v-if=\"!modifyDisabled\"\n          ></i>\n        </div>\n      </div> -->\n  </div>\n</template>\n<script>\nimport { mapState, mapMutations } from \"vuex\";\nimport { Model } from \"../../graph/model\";\nimport { DataUri } from \"@antv/x6\";\nimport { setStore } from \"../../utils/storage\";\nimport { PropertyVisitor } from \"../../graph/propertyVisitor\";\n\nconst antlr4 = require(\"antlr4\");\nconst InputStream = antlr4.InputStream;\nconst CommonTokenStream = antlr4.CommonTokenStream;\nconst GrammarParser = require(\"../../parser/PropertyParser\").PropertyParser;\nconst GrammarLexer = require(\"../../parser/PropertyLexer\").PropertyLexer;\n\nexport default {\n  data() {\n    return {\n      currentSimulationDays: null,\n      currentSimulationSlot: null,\n      modifyDisabled: true,\n      dialogLogInVisible: false,\n      nowait: true,\n    };\n  },\n  components: {},\n  methods: {\n    ...mapMutations([\n      \"ZOOM_GRAPH\",\n      \"POSITIONING_GRAPH\",\n      \"UNDO_GRAPH\",\n      \"REDO_GRAPH\",\n      \"MODIFY_CONFIGDATA\",\n      \"LOAD_CONFIGDATA\",\n      \"SHOW_UPLOAD_DIALOG\",\n      \"SET_MODEL\",\n      \"REMOVE_CELLS\",\n      \"APPEND_HISTORY_SIMULATE_DATA\",\n      \"SET_HISTORY_SIMULATE_DATA\",\n      \"SET_NONCE\",\n    ]),\n    formatTooltip(val) {\n      return val / 100;\n    },\n    /**\n    修改全局配置信息\n     */\n    modifyConfigData() {\n      setStore(\"config_data\", this.configData);\n    },\n\n    /**\n    下载当前模型为json文件\n     */\n    downloadGraph() {\n      //获取时间戳\n      var timestamp = new Date().valueOf();\n      //将全局配置信息和画布数据封装成对象\n      let modelData = {\n        model: { configData: this.configData, graph: this.graph },\n      };\n      const filename = \"Model\" + timestamp + \".json\";\n      const data = JSON.stringify(modelData, undefined, 4);\n      let blob = new Blob([data], { type: \"text/json\" }),\n        a = document.createElement(\"a\");\n      a.download = filename;\n      a.href = window.URL.createObjectURL(blob);\n      // 标签 data- 嵌入自定义属性  屏蔽后也可正常下载\n      a.dataset.downloadurl = [\"text/json\", a.download, a.href].join(\":\");\n      // 添加鼠标事件\n      let event = new MouseEvent(\"click\", {});\n      // 向一个指定的事件目标派发一个事件\n      a.dispatchEvent(event);\n    },\n    /**\n    上传已有的模型，json文件\n     */\n    uploadGraph() {\n      this.SHOW_UPLOAD_DIALOG();\n    },\n    /*\n    开始测算\n    */\n    async startSimulation() {\n      // 测算开始，开启 loading 图标\n      this.nowait = false;\n\n      // 模型初次测算时\n      if (this.model == null) {\n        console.log(\n          \"starting simulation...\",\n          this.configData.simulationDays,\n          \"days\",\n          \" with control slot:\",\n          this.configData.simulationSlot,\n          \"days\"\n        );\n        var model = new Model(\n          this.graph,\n          this.configData.simulationDays,\n          this.configData.simulationSlot\n        );\n\n        this.SET_MODEL(model);\n\n        this.APPEND_HISTORY_SIMULATE_DATA({\n          type: this.nonce,\n          data: this.model.data,\n        });\n      } else {\n        // TODO [Done] 模型已经存在时，其相关参数需要根据画布上的最新状态来更新\n        this.model.selfUpdate(\n          this.graph,\n          this.configData.simulationDays,\n          this.configData.simulationSlot\n        );\n      }\n      // 设置 model 的状态为 1 - 正在测算中\n      this.model.status = 1;\n      await this.model.start();\n\n      // 测算终止（正常终止 / 暂停终止）时更新测算历史数据\n      this.SET_HISTORY_SIMULATE_DATA(this.nocne, this.model.data);\n\n      if (this.model.status != 2) {\n        // 当模型处于非 Pause 状态时\n        console.log(\"the simulation is ended\");\n      }\n\n      //  测算终止（正常终止 / 暂停终止），关闭 loading 图标\n      this.nowait = true;\n\n      this.checkProperty();\n    },\n    /*\n    暂停测算\n    */\n    pauseSimulation() {\n      // TODO 处于暂停状态中，画布上的某些不可改的参数应该置为灰色或不可选(不可新建、删除节点；不可更改的参数如)\n\n      // 测算暂停，关闭 loading 图标\n      this.nowait = true;\n\n      console.log(\"pausing simulation...\");\n      if (this.model == null) {\n        console.log(\"there's no model running!\");\n      } else {\n        // 修改模型的状态为 2 - 暂停\n        this.model.status = 2;\n        console.log(\n          \"The model is paused. \",\n          \"You can only adjust params on existing model. \",\n          \"If you need to adjust the architecture of model, please END current simulation first\"\n        );\n      }\n    },\n    /*\n    结束当前测算\n    */\n    endSimulation() {\n      // 测算暂停，关闭 loading 图标\n      this.nowait = true;\n      console.log(\"ending simulation...\");\n      // 修改模型的状态为 0 - 停止\n      this.model.status = 0;\n      // 将当前模型置为 null\n      this.SET_MODEL(null);\n      console.log(\"the simulation is ended\");\n      // 当前测算结束后，将记录历史数据次数的 nonce 值增加 1\n      this.SET_NONCE(this.nonce + 1);\n    },\n    /**\n     * 下载模型图片\n     */\n    saveGraphToPNG() {\n      this.graph.toPNG(\n        (dataUri) => {\n          // 下载\n          DataUri.downloadDataUri(dataUri, \"chart.png\");\n        },\n        {\n          padding: {\n            top: 20,\n            right: 20,\n            bottom: 20,\n            left: 20,\n          },\n        }\n      );\n    },\n    /**\n     * 获取模型测算进行中的时间\n     */\n    getModelTime() {\n      if (this.model == null) return 0;\n      return this.model.curDay;\n    },\n    /**\n     * 检查 Property 列表中的所有 Property\n     */\n    checkProperty() {\n      for (let i = 0; i < this.ruleLists.length; i++) {\n        const inputStream = new InputStream(this.ruleLists[i].content);\n        const lexer = new GrammarLexer(inputStream);\n        const tokenStream = new CommonTokenStream(lexer);\n        const parser = new GrammarParser(tokenStream);\n        parser.removeErrorListeners();\n        parser.addErrorListener({\n          syntaxError: (\n            recognizer,\n            offendingSymbol,\n            line,\n            column,\n            msg,\n            err\n          ) => {\n            console.error(\n              `${offendingSymbol} line ${line}, col ${column}: ${msg}`\n            );\n            throw err;\n          },\n        });\n        const tree = parser.check();\n        // parser.getInvokingContext()\n        let visitor = new PropertyVisitor(\n          this.model.curDay,\n          this.historySimulateData[this.historySimulateData.length - 1].data,\n          this.graph.model.getNodes()\n        );\n        tree.accept(visitor);\n        if (visitor.state >= 4) {\n          this.ruleLists[i].status = true;\n        }\n      }\n    },\n  },\n  computed: {\n    ...mapState([\n      \"configData\",\n      \"graph\",\n      \"model\",\n      \"nonce\",\n      \"ruleLists\",\n      \"historySimulateData\",\n    ]),\n  },\n  mounted() {},\n};\n</script>\n<style lang=\"scss\" scoped>\n.top-container {\n  //height: 50px;\n  position: fixed;\n  height: calc(100% - 180px);\n  width: 300px;\n  top: 120px;\n  right: calc(100% - (100% - 250px) - 195px);\n  background-color: #ffffff;\n  overflow: scroll;\n  border-radius: 30px;\n  border: 2.5px solid rgb(232, 231, 231);\n  box-shadow: 0 0 2px rgba(226, 226, 226, 0.8);\n\n  .tool-bar {\n    margin-top: 10px;\n    margin-bottom: 10px;\n    h4 {\n      margin-left: 10px;\n      margin-top: 30px;\n    }\n    i {\n      margin: 10px;\n      font-size: 18px;\n      color: #555555;\n      font-weight: bold;\n      cursor: pointer;\n      &:hover {\n        // color: #9a9a9c;\n        color: #409eff;\n      }\n    }\n  }\n  .config-data-box {\n    margin-top: 40px;\n    h4 {\n      margin-left: 10px;\n    }\n    .config-data-input {\n      width: 200px;\n      margin-left: 10px;\n      margin-top: 20px;\n    }\n    .day-slider {\n      margin-left: 15px;\n      margin-bottom: 20px;\n      width: 250px;\n      /deep/ .el-slider__bar {\n        background-color: rgb(94, 91, 91);\n      }\n      /deep/ .el-slider__button {\n        border: 2px solid rgb(94, 91, 91);\n        transition: 0s;\n      }\n    }\n  }\n}\n</style>"]}]}